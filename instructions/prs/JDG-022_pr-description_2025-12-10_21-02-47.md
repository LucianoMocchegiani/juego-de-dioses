# feat(animation): Refactor Animation System and Implement Special Attack

## Resumen
Refactorización completa del sistema de animaciones para soportar estados contextuales (`crouch_walk`, `crouch_idle`) y ataques especiales (`special_attack`). Se migró la lógica hardcodeada a una configuración declarativa centralizada, haciendo el sistema más robusto y fácil de extender.

## Motivación
El sistema de animaciones anterior tenía limitaciones para manejar estados complejos como caminar agachado o interrupciones de ataques. Se requería una arquitectura más flexible para soportar las nuevas mecánicas de sigilo y combate avanzado definidas en JDG-022.

## Criterios de Aceptación
- [x] Estado `crouch_walk` funciona: se activa solo con Ctrl + movimiento
- [x] Estado `crouch_idle` funciona: se activa solo con Ctrl sin movimiento
- [x] Estado `walk` NO se activa cuando `wantsToCrouch = true`
- [x] Estado `run` NO se activa cuando `wantsToCrouch = true`
- [x] Código obsoleto de balanceo eliminado de `render-system.js`
- [x] Prioridades de estados correctamente configuradas
- [x] No hay regresiones en animaciones existentes
- [x] Ataque especial implementado (Ctrl + Click / R)

## Cambios Técnicos

### Frontend
- **Refactorización de `AnimationMixerSystem`**: Se eliminó lógica hardcodeada. Ahora consume configuración de `ANIMATION_MIXER`.
- **Configuración Declarativa**: Se agregaron propiedades `isOneShot` y `preventInterruption` a `animation-config.js` para controlar el comportamiento de ataques.
- **Nuevos Estados**: Se definieron `crouch_walk`, `crouch_idle` y `special_attack` en `ANIMATION_STATES`.
- **Input System**:
    - Soporte para `wantsToSpecialAttack`.
    - Corrección de lógica de detección de teclas (Ctrl vs Alt).
    - Unificación de triggers: `Ctrl + Click` y `R` activan el mismo ataque.
- **Limpieza**: Eliminación de código de animación manual en `render-system.js`.

## Testing
Se realizaron pruebas manuales exhaustivas de las nuevas mecánicas y regresión.
- [x] Probado localmente
- [x] Frontend probado en navegador

### Casos de Prueba Verificados:
1.  **Crouch**: Ctrl + W (caminar agachado), Ctrl quieto (agachado idle).
2.  **Special Attack**: Ctrl + Click y Tecla R activan `sword_judgment`.
3.  **Charged Attack**: Alt + Click activa `charged_axe_chop`.
4.  **Interrupciones**: Atacar y luego intentar moverse no corta la animación (gracias a `preventInterruption`).

## Screenshots/Demo
(No aplica, cambios de comportamiento y lógica interna)

## Referencias
- Ticket: JDG-022
- Documentación relacionada: `frontend/src/ecs/animation/README.md`

## Deployment

### Cambios Requeridos
- [ ] Rebuild Docker images (si se despliega en contenedor)
- [ ] Reiniciar servicios Docker

### Verificación Post-Deployment
- [ ] Verificar frontend en navegador
- [ ] Probar controles de movimiento y combate

## Riesgos y Plan de Rollback
- **Riesgo**: Posibles regresiones en animaciones de combate si la configuración de prioridades es incorrecta.
- **Rollback**: Revertir al commit anterior. Los cambios son puramente de frontend y no afectan base de datos ni backend.

## Anexo: Cambios Fuera del Plan

### Ajuste de Combinaciones de Input
- **Archivo**: `frontend/src/ecs/animation/config/input-combinations-config.js`
- **Cambio**: Se intercambiaron los triggers de `charged_attack` (ahora Alt+Click) y `special_attack` (ahora Ctrl+Click).
- **Razón**: Unificar la experiencia de usuario para que `Ctrl+Click` coincida con la tecla `R` (ambos activan el ataque especial), resolviendo una inconsistencia detectada durante el testing.
