# fix(frontend): Correcci√≥n de Detecci√≥n de Inputs y Sistema de Dodge B√°sico

## Resumen

Corrige problemas cr√≠ticos en el sistema de inputs del frontend que imped√≠an que las teclas Q, E, F, R se detectaran correctamente. Adem√°s, implementa un sistema b√°sico de dodge que se activa con un solo press y aplica movimiento al personaje.

## Motivaci√≥n

Durante las pruebas del sistema de combate se identificaron problemas que bloqueaban funcionalidades cr√≠ticas:
1. Las teclas Q, E, F, R no se detectaban (no aparec√≠an en logs ni activaban acciones)
2. El sistema de dodge no funcionaba correctamente (no se activaba la animaci√≥n, requer√≠a mantener presionada la tecla)
3. El click simple activaba incorrectamente el special attack

Estos problemas imped√≠an que las acciones de combate (parry, dodge, special attack, grab) funcionaran, bloqueando una parte importante del gameplay.

## Criterios de Aceptaci√≥n

- [x] Las teclas Q, E, F, R se detectan correctamente cuando se presionan
- [x] El log `Tecla presionada: [c√≥digo]` aparece en consola para todas las teclas
- [x] El dodge se activa con un solo press de E (no requiere mantener presionado)
- [x] El dodge mueve al personaje en la direcci√≥n de movimiento actual
- [x] Si no hay movimiento, el dodge mueve al personaje hacia adelante
- [x] La animaci√≥n de dodge (`roll_dodge`) se reproduce cuando se presiona E
- [x] El special attack (R) solo se activa cuando se presiona R, no con click simple

## Cambios T√©cnicos

### Frontend

#### InputManager (`frontend/src/systems/input-manager.js`)
- Agregadas teclas `KeyQ`, `KeyE`, `KeyF`, `KeyP` a la lista de `gameKeys` con `preventDefault()` y `stopPropagation()`
- Agregado log de debug `console.log('Tecla presionada:', event.code)` para todas las teclas presionadas

#### InputSystem (`frontend/src/ecs/systems/input-system.js`)
- Cambiada detecci√≥n de dodge para usar `isKeyDown()` en lugar de `checkAction()` para permitir activaci√≥n con un solo press
- La detecci√≥n ahora verifica si la tecla E fue presionada en este frame (no mantenida presionada)

#### CombatSystem (`frontend/src/ecs/systems/combat-system.js`)
- Removido requisito de movimiento para activar dodge (ahora funciona sin movimiento previo)
- El dodge se activa simplemente presionando E

#### PhysicsSystem (`frontend/src/ecs/systems/physics-system.js`)
- Agregada l√≥gica para aplicar impulso de movimiento cuando se hace dodge
- Si hay direcci√≥n de movimiento (WASD), esquivar en esa direcci√≥n
- Si no hay movimiento, esquivar hacia adelante (basado en rotaci√≥n de c√°mara)
- Velocidad de dodge: 20 celdas/segundo (hardcodeada temporalmente)

#### PlayerFactory (`frontend/src/ecs/factories/player-factory.js`)
- Agregado (comentado) `WeaponComponent` por defecto con tipo 'sword' para que las acciones que requieren arma funcionen
- Actualmente comentado por decisi√≥n del usuario, se habilitar√° en JDG-025 (Equipar Armas)

#### Renombrado de Clase (`frontend/src/ecs/animation/states/`)
- Renombrado `state-config.js` ‚Üí `animation-state.js`
- Renombrada clase `StateConfig` ‚Üí `AnimationState` para evitar confusi√≥n con archivos de configuraci√≥n est√°tica
- Actualizados todos los imports y referencias
- Actualizado README de animaciones

#### AnimationMixerSystem (`frontend/src/ecs/systems/animation-mixer-system.js`)
- Agregado log de animaci√≥n reproducida cuando cambia el estado de animaci√≥n

## Testing

- Probado localmente con Docker Compose
- Frontend probado en navegador (Chrome)
- Verificado que todas las teclas se detectan correctamente
- Verificado que dodge funciona con y sin movimiento
- Verificado que animaci√≥n de dodge se reproduce correctamente
- Verificado que special attack solo se activa con R

## Referencias

- Ticket: JDG-026
- Depende de: JDG-021 (Sistema de Combate y Animaciones)
- Bloquea: JDG-027 (Sistema de Dodge Estilo Dark Souls - Refactor)
- Relacionado con: JDG-025 (Equipar Armas)
- Documentaci√≥n relacionada: `frontend/src/ecs/README.md`, `frontend/src/config/input-map-config.js`

## Deployment

### Cambios Requeridos
- [ ] Rebuild Docker images (frontend)
- [ ] Reiniciar servicios Docker

### Verificaci√≥n Post-Deployment
- [ ] Verificar frontend en navegador
- [ ] Verificar que todas las teclas de juego funcionan correctamente
- [ ] Verificar que dodge funciona correctamente
- [ ] Verificar logs de Docker

## Riesgos y Plan de Rollback

**Riesgos:**
- Bajo: Los cambios son principalmente correcciones de bugs y mejoras menores
- El log de debug de teclas puede generar ruido en consola (se puede remover si es necesario)

**Plan de Rollback:**
- Revertir commit y rebuild frontend
- Los cambios no afectan la base de datos ni APIs

## Notas Adicionales

- El sistema de dodge actual es b√°sico y no incluye cooldown ni invencibilidad (i-frames). El refactor completo est√° planificado en JDG-027 con configuraci√≥n centralizada.
- Los logs de debug (`Tecla presionada:` y `üé¨ Animaci√≥n:`) fueron agregados para facilitar troubleshooting. Se pueden remover en el futuro si no son necesarios.
- El `WeaponComponent` fue agregado al jugador pero est√° comentado. Se habilitar√° cuando se implemente el sistema de equipamiento de armas (JDG-025).
- La velocidad de dodge (20 celdas/segundo) est√° hardcodeada temporalmente. Se mover√° a configuraci√≥n en JDG-027.

