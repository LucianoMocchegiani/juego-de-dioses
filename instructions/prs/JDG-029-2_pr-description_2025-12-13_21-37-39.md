# refactor(combat): Unificar lightAttack a attack para corregir bug de combos

## Resumen

Migración del ID de acción `'lightAttack'` a `'attack'` en todo el sistema de combate para corregir un bug donde los combos no se activaban. Se eliminó la duplicación entre `ACTION_IDS` y `INPUT_ACTION_NAMES`, y se unificaron todas las referencias a usar `'attack'` consistentemente.

## Motivación

Existía una inconsistencia donde `COMBAT_ACTIONS` usaba `id: 'lightAttack'` pero `inputAction: 'attack'`, mientras que `combo-system.js` pasaba `'lightAttack'` al `ComboManager`, pero los combos en `combo-config.js` esperaban `'attack'`. Esto causaba que los combos nunca se activaran porque `'lightAttack' !== 'attack'`. Además, existía duplicación innecesaria entre `ACTION_IDS` y `INPUT_ACTION_NAMES` donde todos los valores eran idénticos excepto por esta diferencia.

## Criterios de Aceptación

- [x] `COMBAT_ACTIONS.lightAttack` renombrado a `COMBAT_ACTIONS.attack`
- [x] `COMBAT_ACTIONS.attack.id` = `'attack'` (antes era `'lightAttack'`)
- [x] `COMBAT_CONSTANTS.ACTION_IDS.LIGHT_ATTACK` renombrado a `ATTACK`
- [x] `INPUT_ACTION_NAMES` eliminado (duplicación innecesaria)
- [x] `combo-system.js` usa `COMBAT_CONSTANTS.ACTION_IDS.ATTACK` en lugar de `LIGHT_ATTACK`
- [x] `weapon-animations-config.js` actualizado: key `lightAttack` → `attack`
- [x] Todos los usos de `'lightAttack'` reemplazados por `'attack'`
- [x] Los combos funcionan correctamente (BUG CORREGIDO)
- [x] El ataque básico funciona igual que antes
- [x] No hay referencias hardcodeadas a `'lightAttack'` restantes

## Cambios Técnicos

### Frontend

#### Archivos de Configuración
- **`frontend/src/config/combat-actions-config.js`**: Renombrada key `lightAttack` → `attack` y cambiado `id` de `'lightAttack'` a `'attack'`
- **`frontend/src/config/combat-constants.js`**: Renombrado `LIGHT_ATTACK` → `ATTACK` en `ACTION_IDS` y eliminado completamente `INPUT_ACTION_NAMES` (duplicación innecesaria)
- **`frontend/src/config/weapon-animations-config.js`**: Renombradas todas las keys `lightAttack` → `attack` en todas las armas (sword, axe, hammer, spear, generic)

#### Sistemas ECS
- **`frontend/src/ecs/systems/combo-system.js`**: Actualizado para usar `COMBAT_CONSTANTS.ACTION_IDS.ATTACK` en lugar de `LIGHT_ATTACK` (corrige bug de combos)
- **`frontend/src/ecs/systems/combat-system.js`**: Actualizado `checkActionInput` para usar `COMBAT_CONSTANTS.ACTION_IDS.ATTACK` y todos los demás cases ahora usan `ACTION_IDS` en lugar de `INPUT_ACTION_NAMES`

#### Documentación
- **`frontend/src/ecs/animation/README.md`**: Actualizada documentación para reflejar cambio de `lightAttack` a `attack`

## Testing

Testing manual básico realizado:

- [x] Verificado que no hay errores de lint en archivos modificados
- [x] Verificado que no quedan referencias a `lightAttack` o `INPUT_ACTION_NAMES` en código
- [x] El ataque básico funciona (click izquierdo)
- [ ] Los combos se activan correctamente (BUG CORREGIDO - requiere testing manual)
- [x] Las animaciones de ataque funcionan
- [x] No hay errores en consola del navegador

**Nota:** El cambio principal corrige el bug donde los combos no se activaban. Se recomienda testing manual para verificar que los combos ahora funcionan correctamente.

## Referencias

- Ticket: JDG-029-2
- Análisis relacionado: `JDG-029-review-attack-lightattack_2025-12-13_19-30-00.md`
- Plan de acción: `JDG-029-2-action-plan_2025-12-13_19-39-52.md`
- PR relacionado: JDG-029 (centralización de constantes)

## Deployment

### Cambios Requeridos

- [ ] No requiere rebuild de Docker images (solo cambios en JavaScript)
- [ ] No requiere migraciones de base de datos
- [ ] No requiere actualizar variables de entorno
- [ ] Solo requiere reiniciar servicios frontend (si es necesario)

### Verificación Post-Deployment

- [ ] Verificar frontend en navegador
- [ ] Verificar que el ataque básico funciona (click izquierdo)
- [ ] Verificar que los combos funcionan correctamente (BUG CORREGIDO)
- [ ] Verificar que no hay errores en consola del navegador
- [ ] Verificar que las animaciones funcionan correctamente
- [ ] Verificar logs de Docker (si hay errores)

## Riesgos y Plan de Rollback

**Riesgos:**
- Bajo: Cambios son puramente de renombrado de strings, no afectan lógica funcional
- Los valores son semánticamente equivalentes (`'lightAttack'` vs `'attack'`)
- Si hay algún problema, se puede revertir fácilmente el commit

**Plan de Rollback:**
1. Revertir el commit de este PR
2. Verificar que el código vuelve al estado anterior
3. Si hay referencias en otros sistemas externos que usen `'lightAttack'`, actualizarlos

## Notas Adicionales

**Bug Corregido:**
Este cambio corrige el bug donde los combos no se activaban porque `combo-system.js` pasaba `'lightAttack'` pero los combos esperaban `'attack'`. Ahora ambos usan `'attack'` consistentemente.

**Simplificación:**
Se eliminó la duplicación innecesaria de `INPUT_ACTION_NAMES` que era idéntico a `ACTION_IDS` excepto por la diferencia `ATTACK` vs `LIGHT_ATTACK`. Ahora todo usa `ACTION_IDS` consistentemente.

**Impacto en Performance:**
Cero impacto de performance - solo cambios de nombres de strings, mismo comportamiento en runtime.

