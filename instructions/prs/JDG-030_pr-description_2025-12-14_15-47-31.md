# feat(debug): Sistema de Debugging y Herramientas de Desarrollo

## Resumen

Implementa un sistema completo de debugging para el frontend del juego, incluyendo logging estructurado, inspección de estado ECS, métricas de performance, validación de estado, sistema de eventos, y herramientas visuales de debugging (panel F3 e interfaz GUI F4). Todas las herramientas son opcionales y se activan solo en modo desarrollo.

## Motivación

El juego carecía de herramientas de debugging estructuradas, dificultando la identificación de problemas, inspección de estado en runtime, y monitoreo de performance. Este PR implementa un sistema completo que permite debugging eficiente sin afectar el rendimiento en producción.

## Criterios de Aceptación

- [x] Sistema de logging estructurado funcionando con niveles (debug, info, warn, error)
- [x] Validación de estado detecta estados inválidos y muestra warnings
- [x] Inspector de estado puede inspeccionar entidades y componentes
- [x] Métricas detalladas muestran frame time por sistema
- [x] Sistema de eventos emite y registra eventos para debugging
- [x] Panel de debugging UI muestra métricas y logs en tiempo real (F3)
- [x] Interfaz GUI de debugging con tabs organizados (F4)
- [x] Todas las herramientas son opcionales y no afectan performance cuando están deshabilitadas
- [x] Documentación completa en READMEs y guías de uso

## Cambios Técnicos

### Frontend

**Nuevos archivos:**
- `frontend/src/debug/config.js` - Configuración centralizada del sistema de debugging
- `frontend/src/debug/logger.js` - Sistema de logging estructurado con niveles y contexto
- `frontend/src/debug/inspector.js` - Inspector de estado ECS para inspeccionar entidades y componentes
- `frontend/src/debug/metrics.js` - Sistema de métricas detalladas de performance por sistema
- `frontend/src/debug/validator.js` - Validador de estado para detectar estados inválidos
- `frontend/src/debug/events.js` - Sistema de eventos estructurado para debugging y timeline
- `frontend/src/debug/ui/debug-panel.js` - Panel de debugging visual (F3) con métricas y logs
- `frontend/src/debug/ui/debug-interface.js` - Interfaz GUI de debugging (F4) con tabs organizados
- `frontend/src/debug/README.md` - Documentación general del sistema
- `frontend/src/debug/ui/README.md` - Documentación de herramientas visuales
- `frontend/src/debug/USO-INTERFAZ.md` - Guía de uso de la interfaz F4
- `frontend/src/debug/USO-CONSOLA.md` - Guía de comandos en consola de desarrollo

**Archivos modificados:**
- `frontend/src/app.js` - Integración del sistema de debugging, inicialización de herramientas y exposición en `window.debugTools`
- `frontend/src/ecs/manager.js` - Agregados métodos `getComponentTypes()` y `getSystems()`, integración con `DebugMetrics` para profiling de sistemas
- `frontend/src/ecs/systems/animation-mixer-system.js` - Integración de `debugLogger` y `stateValidator`
- `frontend/src/ecs/systems/combat-system.js` - Integración de `debugLogger`, `stateValidator` y `debugEvents`
- `frontend/src/systems/input-manager.js` - Agregado flag `enabled` para control de input, integración con `debugLogger`

**Características implementadas:**

1. **DebugLogger**: Sistema de logging con niveles (debug, info, warn, error), timestamps, contexto estructurado, filtrado por sistema/nivel, y suscripción para múltiples destinos
2. **ECSInspector**: Inspección de entidades individuales, búsqueda por componente o valor, estadísticas del ECS, y cache para mejorar performance
3. **DebugMetrics**: Frame time por sistema, número de entidades procesadas, estadísticas (avg, min, max), y sampling opcional
4. **StateValidator**: Validación de estados de animación, acciones de combate, y componentes con warnings claros
5. **DebugEventEmitter**: Emisión de eventos estructurados, escucha de eventos específicos, historial con timestamps, y timeline de eventos
6. **DebugPanel (F3)**: Panel visual compacto que muestra métricas de performance y últimas 10 líneas de logs en tiempo real
7. **DebugInterface (F4)**: Interfaz GUI con tabs (Inspector, Métricas, Eventos, Logger, Comandos), filtrado de logs por entidad, control del panel F3, y área de comandos personalizados

**Integración:**
- Detección automática de modo desarrollo basada en `window.location.hostname === 'localhost'` o `process.env.NODE_ENV === 'development'`
- Todas las herramientas se exponen globalmente en `window.debugTools` solo en desarrollo
- Integración con sistemas ECS existentes para logging y validación
- Bloqueo automático de input del juego cuando la interfaz F4 está abierta
- Interfaz transparente que permite ver el juego detrás

## Testing

- [x] Probado localmente en navegador (Chrome/Edge)
- [x] Verificado que herramientas se deshabilitan en producción
- [x] Verificado que `window.debugTools` está disponible en desarrollo
- [x] Probado panel F3 con métricas y logs en tiempo real
- [x] Probado interfaz F4 con todos los tabs funcionales
- [x] Verificado filtrado de logs por entidad
- [x] Verificado bloqueo de input cuando F4 está abierta
- [x] Verificado que logs se muestran correctamente en F3 y F4
- [x] Probado comandos personalizados en tab Comandos
- [x] Verificado selector de entidades y visualización de entidades disponibles

## Screenshots/Demo

La interfaz F4 se activa con la tecla F4 y muestra tabs organizados para diferentes funcionalidades de debugging. El panel F3 se activa con F3 o desde F4 → Logger y muestra métricas y logs de forma compacta.

## Referencias

- Ticket: JDG-030
- Plan de acción: `instructions/tasks/JDG-030-action-plan_2025-12-14_13-28-29.md`
- Análisis de arquitectura: `instructions/analysis/JDG-030-debugging-system-analysis_2025-12-14_13-17-08.md`

## Deployment

### Cambios Requeridos

- [ ] Rebuild Docker images (si aplica)
- [ ] No se requieren migraciones de base de datos
- [ ] No se requieren cambios en variables de entorno
- [ ] Reiniciar servicios Docker (si aplica)

### Verificación Post-Deployment

- [x] Verificar que herramientas de debugging están deshabilitadas en producción
- [x] Verificar que `window.debugTools` no está disponible en producción
- [x] Verificar que herramientas funcionan correctamente en desarrollo (localhost)
- [x] Verificar que panel F3 y interfaz F4 se activan correctamente

## Riesgos y Plan de Rollback

**Riesgos:**
- Bajo riesgo: Las herramientas están completamente deshabilitadas en producción por defecto
- El código de debugging no se ejecuta si `DEBUG_CONFIG.enabled === false`
- No hay impacto en performance en producción

**Plan de Rollback:**
- Revertir el commit si es necesario
- Las herramientas no afectan funcionalidad del juego si están deshabilitadas

## Notas Adicionales

- El sistema detecta modo desarrollo basándose en `window.location.hostname === 'localhost'` además de `process.env.NODE_ENV` para mayor compatibilidad con diferentes configuraciones de build
- La interfaz F4 bloquea automáticamente el input del juego cuando está abierta para evitar interferencias
- Los logs se pueden filtrar por entidad ID en la interfaz F4 para debugging granular
- El panel F3 muestra las últimas 10 líneas de logs para monitoreo rápido sin abrir la interfaz completa

## Anexo: Cambios Fuera del Plan

### Mejoras Adicionales a la Interfaz

- **Archivo:** `frontend/src/debug/ui/debug-interface.js`
- **Cambio:** Interfaz GUI completa con tabs organizados (reemplazó diseño inicial de consola de comandos)
- **Razón:** Mejor experiencia de usuario, permite copiar/pegar, y es más intuitiva que una consola de comandos
- **Impacto:** Mejora significativa en usabilidad del sistema de debugging

### Filtrado de Logs por Entidad

- **Archivo:** `frontend/src/debug/ui/debug-interface.js`
- **Cambio:** Agregado filtrado visual de logs por entityId con selector dropdown y botón para ver entidades disponibles
- **Razón:** Permite debugging granular enfocándose en logs de entidades específicas
- **Impacto:** Facilita debugging de problemas relacionados con entidades específicas

### Control del Panel F3 desde F4

- **Archivo:** `frontend/src/debug/ui/debug-interface.js`, `frontend/src/debug/ui/debug-panel.js`
- **Cambio:** El panel F3 ahora se controla principalmente desde la interfaz F4 (tab Logger), con F3 como atajo opcional
- **Razón:** Centralizar control de herramientas de debugging en una sola interfaz
- **Impacto:** Mejor organización y control unificado

### Bloqueo de Input del Juego

- **Archivo:** `frontend/src/debug/ui/debug-interface.js`, `frontend/src/systems/input-manager.js`
- **Cambio:** Agregado flag `enabled` en `InputManager` y bloqueo automático cuando F4 está abierta
- **Razón:** Evitar que el personaje se mueva o ejecute acciones mientras se usa la interfaz de debugging
- **Impacto:** Mejora la experiencia de uso de la interfaz de debugging

### Documentación de Uso

- **Archivos:** `frontend/src/debug/USO-INTERFAZ.md`, `frontend/src/debug/USO-CONSOLA.md`
- **Cambio:** Creadas guías detalladas de uso de la interfaz GUI y comandos de consola
- **Razón:** Facilitar el uso del sistema de debugging para desarrolladores
- **Impacto:** Mejora la adopción y uso efectivo del sistema
