# refactor(frontend): Reorganización Arquitectónica del Frontend (JDG-035)

## Resumen

Refactorización completa de la arquitectura del frontend organizando el código en módulos claros y cohesivos. El código estaba disperso en múltiples módulos con responsabilidades mezcladas (terreno en managers/renderers/utils, infraestructura mezclada con dominio, modelos en renderers aunque solo se usan por ECS). Esta PR implementa la reorganización en tres fases: consolidación del sistema de terreno, reorganización de módulos restantes, y análisis de módulos finales.

## Motivación

Antes de esta refactorización, el código del frontend tenía problemas de organización que dificultaban el mantenimiento y la escalabilidad:
- Código de terreno disperso en múltiples módulos sin cohesión
- Infraestructura base mezclada con código específico de dominio
- Modelos 3D ubicados incorrectamente (en renderers aunque solo se usan por ECS)
- Servicios de integración sin una ubicación clara
- Módulos vacíos sin propósito claro

Esta refactorización resuelve estos problemas organizando el código según su propósito y dependencias, siguiendo principios de separación de responsabilidades y organización por dominio.

## Criterios de Aceptación

- [x] Sistema de terreno consolidado en módulo autocontenido
- [x] Infraestructura base movida a core/
- [x] Modelos 3D movidos a ecs/models/
- [x] Servicios de integración movidos a world/
- [x] Todos los imports actualizados correctamente
- [x] Módulos vacíos eliminados
- [x] Sin errores de linter
- [x] Documentación actualizada

## Cambios Técnicos

### Frontend

**JDG-035-2: Refactorización del Sistema de Terreno**
- `ViewportManager` → `terrain/components/viewport.js` + `terrain/systems/viewport-system.js`
- `StyleManager` → `terrain/components/style.js` + `terrain/systems/style-system.js`
- `GeometryCache` → `terrain/components/geometry.js`
- `ParticleRenderer` → `terrain/renderers/particle-renderer.js`
- `LODManager`, `ParticleLimiter` → `terrain/optimizations/`
- `culling.js`, `sorting.js` → `terrain/utils/`
- API clients → `terrain/api/`
- Creado `TerrainManager` como punto de entrada único con soporte para terreno dinámico

**JDG-035-3: Reorganización de Módulos Restantes**
- Infraestructura base → `core/`:
  - `renderers/geometries/registry.js` → `core/geometries/registry.js`
  - `renderers/base-renderer.js` → `core/renderers/base-renderer.js`
  - `managers/performance-manager.js` → `core/performance/performance-manager.js`
  - `systems/input-manager.js` → `core/input/input-manager.js`
- Modelos 3D → `ecs/models/`:
  - `renderers/models/` completo → `ecs/models/`
  - Incluye: model-loader.js, model-cache.js, bones-utils.js, vertex-groups-utils.js, model-utils.js
- Servicios de integración → `world/`:
  - `systems/camera-controller.js` → `world/camera-controller.js`
  - `systems/collision-detector.js` → `world/collision-detector.js`
- Eliminados módulos vacíos/no utilizados: `renderers/`, `managers/`, `systems/`, `components/`
- Actualizados todos los imports en el proyecto

**JDG-035-4: Análisis de Módulos Restantes**
- Decisión de mantener `state/` y `utils/` en raíz
- `state/` gestiona estado global de la aplicación (concepto de nivel aplicación)
- `utils/` es pequeño y manejable, con dependencias claras, sigue convenciones comunes
- Eliminado módulo `components/` (no utilizado):
  - Contenía componentes UI (Button, Panel, Loading, InfoPanel) que no se estaban usando
  - README actualizado para remover referencias

## Testing

- [x] Todos los imports actualizados y verificados
- [x] Sin errores de linter
- [x] Estructura verificada
- [x] Documentación actualizada
- [x] Compatibilidad de API mantenida (TerrainManager, Store, actions, selectors sin cambios)

Nota: Esta es una refactorización puramente estructural. Se recomienda ejecutar tests completos para verificar que nada se rompió.

## Screenshots/Demo

No aplica - refactorización estructural sin cambios visuales.

## Referencias

- Ticket: JDG-035
- Análisis JDG-035-2: `instructions/analysis/JDG-035-2-architecture-analysis_*.md`
- Análisis JDG-035-3: `instructions/analysis/JDG-035-3-architecture-analysis_*.md`
- Análisis JDG-035-4: `instructions/analysis/JDG-035-4-architecture-analysis_*.md`

## Deployment

### Cambios Requeridos

- [ ] Rebuild Docker images (si aplica cache)
- [ ] Verificar que frontend funciona correctamente
- [ ] Verificar logs de Docker para errores de imports

### Verificación Post-Deployment

- [ ] Verificar frontend carga correctamente en navegador
- [ ] Verificar terreno se renderiza correctamente
- [ ] Verificar personajes se cargan correctamente
- [ ] Verificar cámara sigue al jugador
- [ ] Verificar logs de Docker no muestran errores de imports

## Riesgos y Plan de Rollback

**Riesgos identificados:**
- Posibles imports rotos si hay código externo que importa módulos eliminados
- Cache de build podría tener referencias antiguas

**Plan de rollback:**
1. Revertir commits de esta PR
2. Verificar que código vuelve a estado anterior
3. Si hay problemas con cache, hacer rebuild completo de imágenes Docker

**Mitigación:**
- Todos los imports fueron actualizados sistemáticamente
- Se verificó que no hay referencias a módulos eliminados en el código actual
- Documentación actualizada para referencia futura

## Notas Adicionales

**Estructura final resultante:**
```
src/
├── core/          # Infraestructura base compartida (geometries, renderers, performance, input)
├── ecs/           # Sistema ECS (con models/ para carga de modelos 3D)
├── terrain/       # Sistema de terreno autocontenido
├── world/         # Servicios de integración (camera-controller, collision-detector)
├── state/         # Estado global (mantenido en raíz)
└── utils/         # Utilidades generales (mantenido en raíz)
```

**Breaking changes:**
- Módulos `renderers/`, `managers/`, `systems/`, `components/` eliminados (vacíos/no utilizados tras migración)
- Todos los imports actualizados automáticamente
- Si hay código externo que importa estos módulos, requiere actualización
