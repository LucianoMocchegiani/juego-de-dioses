# feat(frontend): Reflejo Realista de la Luna (JDG-042)

## Resumen

Implementa reflejo realista de la luna: la luna ahora refleja la luz del sol en lugar de emitir luz propia. Three.js calcula automáticamente qué parte está iluminada según la posición del sol, mostrando visualmente las fases lunares según el modelo de Gleason.

## Motivación

La luna actualmente emite luz propia (`emissive` configurado), lo que hace que se vea completa siempre sin importar la fase. Esto no es realista: la luna debería reflejar la luz del sol, mostrando visualmente sus fases (creciente, menguante, llena, nueva) según la posición relativa del sol, la luna y el observador.

## Criterios de Aceptación

- [x] La luna NO emite luz propia (`emissive = 0x000000`, `emissiveIntensity = 0.0`)
- [x] La luna refleja la luz del sol automáticamente (usando `MeshStandardMaterial`)
- [x] La parte iluminada por el sol se ve brillante, la parte oscura se ve oscura
- [x] La fase visual coincide con la fase calculada por el modelo de Gleason
- [x] No se rompe código existente (compatibilidad mantenida)

## Cambios Técnicos

### Frontend

- **Modificado `frontend/src/world/celestial-renderer.js`**:
  - Cambiado material de la luna de `emissive: this.lunaColor` a `emissive: 0x000000`
  - Cambiado `emissiveIntensity` de `0.3` a `0.0`
  - Agregado `metalness: 0.2` y `roughness: 0.8` para reflejo realista
  - Simplificado método `updateLunaPhase()`: Three.js calcula automáticamente la fase visual según la dirección de la luz
  - Actualizados comentarios para explicar que la luna refleja la luz del sol

- **Modificado `frontend/src/config/constants.js`**:
  - Aumentado `CAMERA_FAR` de `1000` a `3000` para ver sol y luna que orbitan a ~1500m del centro
  - Agregado comentario explicativo

## Testing

- [x] Probado localmente con Docker Compose
- [x] Verificado que la luna NO emite luz propia (parte oscura visible)
- [x] Verificado que la luna refleja la luz del sol (parte iluminada brillante)
- [x] Verificado que la parte iluminada cambia automáticamente según posición del sol
- [x] Verificado que la fase visual coincide con la fase del modelo de Gleason
- [x] Verificado rendimiento (FPS no degradado)
- [x] Verificado que no se rompe iluminación existente

## Referencias

- Ticket: JDG-042
- Plan de acción: `instructions/tasks/JDG-042-action-plan_2025-12-30_17-08-22.md`
- Análisis de arquitectura: `instructions/analysis/JDG-042-architecture-analysis_2025-12-30_16-28-06.md`
- Relacionado con: JDG-041 (Sistema de temperatura con ciclo día/noche)

## Deployment

### Cambios Requeridos

- [x] Rebuild Docker images (ya aplicado con cambios)
- [ ] Ejecutar migraciones de base de datos: No requiere migraciones
- [ ] Actualizar variables de entorno: No se requieren nuevas variables
- [x] Reiniciar servicios Docker (ya aplicado)

### Verificación Post-Deployment

- [ ] Verificar que la luna NO emite luz propia (parte oscura visible)
- [ ] Verificar que la luna refleja la luz del sol (parte iluminada brillante)
- [ ] Verificar que la parte iluminada cambia automáticamente según posición del sol
- [ ] Verificar que la fase visual coincide con la fase del modelo de Gleason
- [ ] Verificar que el material de la luna no cambia (solo cambia qué parte está iluminada)
- [ ] Verificar rendimiento (FPS no degradado)
- [ ] Verificar que no se rompe iluminación existente

## Riesgos y Plan de Rollback

**Riesgos identificados:**
- Cambio mínimo en propiedades del material, riesgo bajo
- La luna puede ser menos visible durante luna nueva (fase 0.0 o 1.0), pero esto es correcto según el modelo de Gleason

**Plan de rollback:**
1. Revertir cambios en `frontend/src/world/celestial-renderer.js` (restaurar `emissive: this.lunaColor` y `emissiveIntensity: 0.3`)
2. Revertir cambio en `frontend/src/config/constants.js` (restaurar `CAMERA_FAR = 1000`)
3. Rebuild y restart de contenedores Docker
4. Verificar que la luna vuelve a emitir luz propia

## Notas Adicionales

- Three.js calcula automáticamente qué parte de la luna está iluminada según la dirección de la luz direccional (sol)
- La fase visual se ve automáticamente porque la luz viene del sol y se mueve según el modelo de Gleason
- No se requiere shader ni texturas adicionales: Three.js lo hace automáticamente con `MeshStandardMaterial`
- El material de la luna no cambia dinámicamente: solo cambia qué parte está iluminada según la posición del sol relativa al observador
- El cambio de `CAMERA_FAR` fue necesario para ver el sol y la luna que orbitan a ~1500m del centro del mundo

