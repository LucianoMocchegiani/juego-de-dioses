# feat(animations): Animaciones Direccionales de Caminar

## Resumen

Implementa sistema de animaciones direccionales para caminar, permitiendo que el personaje muestre diferentes animaciones según la tecla presionada (W, A, S, D). El sistema verifica directamente las teclas presionadas para seleccionar la animación correspondiente, sin cálculos complejos de rotación. También se restringe el movimiento a una dirección a la vez y se limita correr solo a la dirección adelante.

## Motivación

Actualmente todas las direcciones de movimiento (WASD) utilizan la misma animación de caminar hacia adelante, lo cual es visualmente incorrecto. Las animaciones direccionales ya fueron obtenidas desde Meshy y están disponibles en el backend, solo faltaba implementar la lógica para seleccionarlas según la dirección del movimiento.

## Criterios de Aceptación

- [x] Cuando el jugador presiona W (adelante), se reproduce la animación de caminar hacia adelante
- [x] Cuando el jugador presiona S (atrás), se reproduce la animación de caminar hacia atrás
- [x] Cuando el jugador presiona D (derecha), se reproduce la animación de caminar hacia la derecha
- [x] Cuando el jugador presiona A (izquierda), se reproduce la animación de caminar hacia la izquierda
- [x] Solo se usa una dirección a la vez, sin combinar teclas para movimiento diagonal
- [x] Correr solo funciona hacia adelante (Shift + W)
- [x] Las animaciones direccionales aparecen en la interfaz F6 para testing
- [x] No hay regresiones en otras animaciones existentes

## Cambios Técnicos

### Frontend

**`frontend/src/config/animation-config.js`:**
- Agregadas animaciones direccionales a `ANIMATION_FILES`:
  - `walk_forward`: `Walking_withSkin.glb` (adelante)
  - `walk_backward`: `Walk_Backward_inplace_withSkin.glb` (atrás)
  - `walk_left`: `BackLeft_run_withSkin.glb` (izquierda)
  - `walk_right`: `BackRight_Run_withSkin.glb` (derecha)

**`frontend/src/ecs/systems/animation-mixer-system.js`:**
- Modificado `getAnimationNameForState()` para aceptar `InputComponent` opcional
- Implementada lógica simple que verifica directamente las teclas presionadas (KeyW, KeyS, KeyA, KeyD)
- Prioridad de selección: W > S > A > D (solo una dirección a la vez)
- Agregado tracking de `currentAnimationName` para detectar cambios en animaciones direccionales
- Modificado `resolveAnimationName()` para pasar `InputComponent` cuando el estado es 'walk'
- Modificado `playAnimation()` para pasar `InputComponent` cuando el estado es 'walk'
- Actualizado `update()` para usar `animationName` resuelto en lugar de `stateToUse`

**`frontend/src/ecs/systems/input-system.js`:**
- Modificada lógica de movimiento para usar `else if` en lugar de múltiples `if`, restringiendo a una dirección a la vez
- Prioridad: W (adelante) > S (atrás) > A (izquierda) > D (derecha)
- Modificada lógica de correr: solo se activa si se presiona Shift + W (adelante)
- Si se presiona Shift + S/A/D, el personaje camina normalmente, no corre

**`frontend/src/interfaces/test-interface.js`:**
- Modificado `renderAnimationList()` para recargar animaciones desde `ANIMATION_FILES` en cada renderizado
- Esto asegura que las nuevas animaciones direccionales aparezcan en la interfaz F6 sin necesidad de recargar la página

## Testing

- Probado localmente con Docker Compose
- Verificado que las animaciones direccionales se muestran correctamente en F6
- Verificado que W, A, S, D muestran las animaciones correspondientes
- Verificado que solo se usa una dirección a la vez (W+D solo usa W)
- Verificado que correr solo funciona con Shift + W
- Verificado que no hay regresiones en otras animaciones (run, jump, attack, etc.)

## Referencias

- Ticket: JDG-051
- Animaciones obtenidas desde: https://www.meshy.ai/
- Ubicación de animaciones: `backend/static/models/biped/male/animations/movement/`
- Relacionado con: JDG-052 (animaciones direccionales de agacharse), JDG-053 (animaciones direccionales de nadar)

## Deployment

### Cambios Requeridos

- [ ] Rebuild Docker images (si hay cambios en frontend)
- [ ] Verificar que los archivos GLB estén en `backend/static/models/biped/male/animations/movement/`:
  - `Walk_Backward_inplace_withSkin.glb`
  - `BackLeft_run_withSkin.glb`
  - `BackRight_Run_withSkin.glb`
  - `Walking_withSkin.glb` (ya existe)

### Verificación Post-Deployment

- [ ] Verificar que las animaciones direccionales se cargan correctamente
- [ ] Verificar que W, A, S, D muestran las animaciones correctas
- [ ] Verificar que correr solo funciona con Shift + W
- [ ] Verificar que no hay errores 404 en la consola del navegador

## Riesgos y Plan de Rollback

**Riesgos:**
- Si los archivos GLB no están en el backend, las animaciones direccionales no se cargarán (pero hay fallback a `walk`)
- Cambios en InputSystem podrían afectar el movimiento si hay bugs

**Plan de Rollback:**
- Revertir cambios en `animation-mixer-system.js` y `input-system.js`
- Las animaciones direccionales en `ANIMATION_FILES` no afectan el sistema si no se usan (solo se cargan si se referencian)

## Anexo: Cambios Fuera del Plan

### Restricción de Movimiento a Una Dirección

- **Archivo:** `frontend/src/ecs/systems/input-system.js`
- **Cambio:** Modificada lógica de movimiento para usar `else if` en lugar de múltiples `if`
- **Razón:** El usuario solicitó que solo se use una dirección a la vez, sin combinar teclas para movimiento diagonal. El movimiento diagonal se maneja con la rotación de la cámara.
- **Impacto:** Cambia el comportamiento de movimiento, pero mejora la claridad y evita confusión

### Restricción de Correr Solo Hacia Adelante

- **Archivo:** `frontend/src/ecs/systems/input-system.js`
- **Cambio:** `input.isRunning` solo es `true` si se presiona Shift + W (adelante)
- **Razón:** El usuario solicitó que correr solo funcione hacia adelante, no hacia atrás ni a los costados
- **Impacto:** Cambia el comportamiento de correr, pero es más realista y consistente

### Actualización de TestInterface

- **Archivo:** `frontend/src/interfaces/test-interface.js`
- **Cambio:** `renderAnimationList()` ahora recarga animaciones desde `ANIMATION_FILES` en cada renderizado
- **Razón:** Para que las nuevas animaciones direccionales aparezcan en F6 sin necesidad de recargar la página
- **Impacto:** Mejora la experiencia de desarrollo, sin efectos negativos

### Simplificación de Lógica de Dirección

- **Archivo:** `frontend/src/ecs/systems/animation-mixer-system.js`
- **Cambio:** Se eliminó la función `getMovementDirection()` compleja que calculaba direcciones relativas al personaje
- **Razón:** El usuario solicitó usar una estrategia más simple: verificar directamente las teclas presionadas (KeyW, KeyS, KeyA, KeyD)
- **Impacto:** Código más simple, más confiable y sin bugs de desacomodo
