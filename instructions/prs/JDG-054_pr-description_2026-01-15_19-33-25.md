# fix(animations): Unificar Transiciones de Animación entre Gameplay Normal y F6

## Resumen

Unifica el comportamiento de transiciones en `playAnimation()` para que sea igual al de `playAnimationByName()` (F6). Esto hace que las transiciones sean más suaves y consistentes, eliminando diferencias visuales entre gameplay normal y la herramienta de debugging.

## Motivación

Las transiciones de animación en gameplay normal tenían un comportamiento diferente al de la herramienta de debugging (F6), causando inconsistencias visuales. La herramienta F6 mostraba transiciones más suaves, mientras que el gameplay normal tenía transiciones menos consistentes.

## Criterios de Aceptación

- [x] Las transiciones en gameplay normal son iguales a las de F6 (herramienta de debugging)
- [x] Las transiciones entre todas las animaciones son visualmente suaves
- [x] No hay regresiones en otras funcionalidades de animación o combate

## Cambios Técnicos

### Frontend

- **Modificado `animation-mixer-system.js`:**
  - Cambiada lógica de `fadeOut` para siempre hacer fadeOut si hay animación anterior corriendo y el estado cambió (igual que `playAnimationByName`)
  - Cambiado `clampWhenFinished = false` a `clampWhenFinished = true` para animaciones one-shot (igual que `playAnimationByName`)
  - Esto unifica el comportamiento entre gameplay normal y F6, haciendo las transiciones más suaves y consistentes

## Testing

- Probado localmente verificando transiciones de `combat_stance` → ataque → `combat_stance`
- Comparado visualmente con F6 para verificar que las transiciones son iguales
- Verificado que no hay regresiones en otras animaciones (walk, run, jump, etc.)
- Verificado que las animaciones de combate mantienen su comportamiento correcto

## Referencias

- Ticket: JDG-054
- Análisis relacionado: `instructions/analysis/JDG-054-architecture-analysis_2026-01-14_19-24-01.md`
- Nota: El problema de desplazamiento durante animaciones (root motion) se ha movido a JDG-055 para ser abordado más adelante

## Deployment

### Cambios Requeridos

- [ ] Rebuild Docker images (si aplica)
- [ ] Reiniciar servicios Docker (si aplica)

### Verificación Post-Deployment

- [ ] Verificar frontend en navegador
- [ ] Verificar que las transiciones de animación son suaves y consistentes
- [ ] Verificar que no hay regresiones en otras funcionalidades

## Riesgos y Plan de Rollback

**Riesgos:**
- Bajo riesgo: Cambios simples en lógica de transiciones, sin afectar otras funcionalidades
- Las transiciones pueden verse ligeramente diferentes, pero deberían ser más suaves

**Plan de Rollback:**
- Revertir cambios en `animation-mixer-system.js` si hay problemas
- Los cambios son localizados y fáciles de revertir

## Notas Adicionales

- Este PR solo incluye la unificación de transiciones
- El problema de desplazamiento durante animaciones (root motion) se ha movido a JDG-055 para ser abordado más adelante
- Los cambios son simples y no afectan otras funcionalidades del sistema de animaciones
