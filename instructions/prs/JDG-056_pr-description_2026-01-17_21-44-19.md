# feat(animations): Animaciones Direccionales de Nadar

## Resumen

Implementa sistema de animaciones direccionales para nadar, permitiendo que el personaje muestre diferentes animaciones según la tecla presionada (W, A, S, D) cuando está nadando. El sistema verifica directamente las teclas presionadas para seleccionar la animación correspondiente, similar a JDG-051 (caminar) y JDG-052 (agacharse). Usa `swim_forward` para adelante (W) y `swim_idle` como fallback para atrás, izquierda y derecha (S, A, D) ya que no existen animaciones específicas para estas direcciones.

## Motivación

Actualmente todas las direcciones de natación (WASD) utilizan la misma animación `swim_forward`, lo cual es visualmente incorrecto y reduce la inmersión del jugador. Las animaciones `swim_forward` y `swim_idle` ya están disponibles en el backend, solo faltaba implementar la lógica para seleccionarlas según la dirección del movimiento. Para las direcciones sin animaciones específicas (atrás, izquierda, derecha), se usa `swim_idle` como fallback.

## Criterios de Aceptación

- [x] Cuando el jugador presiona W mientras nada, se reproduce animación `swim_forward`
- [x] Cuando el jugador presiona S mientras nada, se reproduce animación `swim_idle` (fallback)
- [x] Cuando el jugador presiona D mientras nada, se reproduce animación `swim_idle` (fallback)
- [x] Cuando el jugador presiona A mientras nada, se reproduce animación `swim_idle` (fallback)
- [x] El sistema verifica directamente las teclas presionadas (KeyW, KeyS, KeyA, KeyD) similar a JDG-051 y JDG-052
- [x] Solo se usa una dirección a la vez (prioridad: W > S > A > D), sin combinar teclas para movimiento diagonal
- [x] Si las animaciones direccionales de nadar no están disponibles, el sistema usa `swim_forward` como fallback
- [x] Las animaciones direccionales aparecen en la interfaz F6 para testing
- [x] No hay regresiones en otras animaciones existentes

## Cambios Técnicos

### Frontend

**`frontend/src/ecs/systems/animation-mixer-system.js`:**
- Extendido `getAnimationNameForState()` para soportar animaciones direccionales de `swim`
- Implementada lógica simple que verifica directamente las teclas presionadas (KeyW, KeyS, KeyA, KeyD) cuando el estado es `swim`
- Prioridad de selección: W > S > A > D (solo una dirección a la vez)
- W (adelante) retorna `swim_forward`
- S (atrás), A (izquierda), D (derecha) retornan `swim_idle` (fallback, no existen animaciones específicas)
- Modificado `resolveAnimationName()` para pasar `InputComponent` cuando el estado es `swim` (además de `walk` y `crouch_walk`)
- Modificado `playAnimation()` para obtener `InputComponent` cuando el estado es `swim` (además de `walk`)
- Modificado `playAnimation()` para detectar cambios en animaciones direccionales de `swim` (similar a `walk` y `crouch_walk`)
- Esto permite transiciones suaves al cambiar de dirección mientras se nada

## Testing

- Probado localmente con Docker Compose
- Verificado que W reproduce `swim_forward` mientras nada
- Verificado que S, A, D reproducen `swim_idle` mientras nada
- Verificado que solo se usa una dirección a la vez (W+D solo usa W)
- Verificado que las animaciones direccionales aparecen en la interfaz F6
- Verificado que no hay regresiones en otras animaciones (walk, run, jump, attack, crouch_walk, etc.)

## Referencias

- Ticket: JDG-056
- Animaciones obtenidas desde: Meshy (https://www.meshy.ai/)
- Ubicación de animaciones: `backend/static/models/biped/male/animations/movement/`
- Relacionado con: JDG-051 (animaciones direccionales de caminar) - reutiliza la misma estrategia simple
- Relacionado con: JDG-052 (animaciones direccionales de agacharse) - reutiliza la misma estrategia simple
- PRs relacionados: JDG-051, JDG-052

## Deployment

### Cambios Requeridos

- [ ] Rebuild Docker images (si hay cambios en frontend)
- [ ] Verificar que los archivos GLB estén en `backend/static/models/biped/male/animations/movement/`:
  - `Swim_Forward_withSkin.glb` (ya existe)
  - `Swim_Idle_withSkin.glb` (ya existe)

### Verificación Post-Deployment

- [ ] Verificar que W reproduce `swim_forward` mientras nada
- [ ] Verificar que S, A, D reproducen `swim_idle` mientras nada
- [ ] Verificar que solo se usa una dirección a la vez (prioridad: W > S > A > D)
- [ ] Verificar que las animaciones direccionales aparecen en la interfaz F6
- [ ] Verificar que no hay errores en la consola del navegador
- [ ] Verificar que no hay regresiones en otras animaciones

## Riesgos y Plan de Rollback

**Riesgos:**
- Si los archivos GLB no están en el backend, las animaciones no se cargarán (pero hay fallback a `swim_forward` desde el estado config)
- Cambios en AnimationMixerSystem podrían afectar otras animaciones si hay bugs

**Plan de Rollback:**
- Revertir cambios en `animation-mixer-system.js`
- Las animaciones `swim_forward` y `swim_idle` ya existían en `ANIMATION_FILES`, así que no hay riesgo de archivos faltantes

## Notas Adicionales

- Se usa `swim_idle` como fallback para S, A, D porque no existen animaciones específicas (`swim_backward`, `swim_left`, `swim_right`) en el backend
- Si en el futuro se agregan animaciones direccionales específicas de nadar, solo se necesita actualizar `getAnimationNameForState()` para retornar los nombres correctos
- El sistema funciona correctamente incluso sin animaciones direccionales específicas gracias al fallback robusto
- Reutiliza la misma estrategia simple de JDG-051 y JDG-052: verificar teclas directamente (KeyW, KeyS, KeyA, KeyD) en lugar de cálculos complejos
