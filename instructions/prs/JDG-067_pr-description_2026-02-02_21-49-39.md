# refactor(frontend): Estructura hexagonal, ECS por dominios y limpieza

## Resumen

Refactoriza el frontend para alinearlo con la estructura documentada: capa hexagonal (ports + adapters HTTP), casos de uso en application/, driving (game loop, input, UI), rendering (scene, loaders, ecs, terrain, world), state, config, shared. El ECS queda bajo `rendering/ecs/` con core, components, domains por feature (animation, combat, input, physics, collision, render, weapon) y factories. Se eliminan `api/`, `core/`, `interfaces/`, `utils/` y referencias obsoletas; la entrada al juego sigue siendo main.js → bootstrap → App.

## Motivación

Unificar la organización del frontend con un patrón claro (hexagonal + ECS por dominios), eliminar duplicación (api vs adapters), y preparar el código para futuras features (interfaces de configuración, inventario, constructor in-game). El backend ya usa hexagonal + DDD; el front queda alineado en concepto.

## Criterios de Aceptación

- [x] Existen adapters/http/ y uso de ports inyectados (worldApi, charactersApi, etc.); App y casos de uso usan ports.
- [x] Casos de uso en application/ (loadWorld, spawnPlayer, syncCelestial) orquestan ports y store.
- [x] Todo lo 3D bajo rendering/; ECS en rendering/ecs/ con core/, components/, domains/, factories/; loaders en rendering/loaders/.
- [x] Game loop y bootstrap en driving/game/; paneles en driving/ui/panels/.
- [x] Utilidades puras en shared/; config y state en raíz.
- [x] Eliminadas carpetas obsoletas: api/, core/, interfaces/, utils/ (o contenido migrado).
- [x] El juego arranca y funciona sin regresiones (movimiento, animaciones, combate, F3, F6, terreno, cielo).

## Cambios Técnicos

### Frontend

- **Ports y adapters:** ApiClient y adapters HTTP (HttpBloquesApi, HttpCharactersApi, HttpCelestialApi, HttpAgrupacionesApi, HttpParticlesApi) en `adapters/http/`. Ports inyectados en App vía bootstrap; PlayerFactory recibe `charactersApi` por parámetro en lugar de importar desde api/.
- **Application:** loadWorld, spawnPlayer, syncCelestial en `application/`; spawnPlayer pasa `ports.charactersApi` a PlayerFactory.createPlayer().
- **Driving:** game-bootstrap crea ApiClient, adapters, ports y store; sin initCharactersApi. Game loop y paneles en driving/game y driving/ui/panels.
- **Rendering:** scene, loaders, ecs, terrain, world, optimizations, geometries, renderers bajo `rendering/`. ECS reestructurado por dominios: core/, components/, domains/animation|combat|input|physics|collision|render|weapon (cada uno con systems/, helpers/ y donde aplique state-machine/, combos/), factories/.
- **Limpieza:** Eliminada carpeta `api/` (endpoints y client); eliminados core/, interfaces/, utils/ o su contenido migrado a rendering/, driving/, shared/, config/. Actualizados imports en dev-exposure y puntos de entrada.

### Docker/Infraestructura

- Sin cambios. El front se sirve igual (Docker/nginx); no se requiere build adicional para levantar con Docker.

## Testing

- Arranque con Docker; carga de mundo y spawn de jugador sin errores.
- Movimiento WASD, saltar, animaciones, combate, colisiones, cámara.
- Terrain y partículas; F3 y F6 (debug y herramientas).
- Cielo (sol/luna) y sincronización celestial.
- Sin 404 en recursos ni errores en consola.

## Referencias

- Ticket: JDG-067
- Plan: instructions/tasks/JDG-067-action-plan_2026-02-02_20-01-34.md
- Documentación: docs/frontend-estructura-elegida.md, docs/frontend-estructura-ecs.md

## Deployment

### Cambios Requeridos

- [ ] No rebuild de imágenes si solo cambian estáticos; reinicio o recarga del servicio front si aplica.
- [ ] Verificar que el volumen o copia del frontend en Docker apunte a la nueva estructura de carpetas.

### Verificación Post-Deployment

- [ ] Abrir el juego en el navegador
- [ ] Verificar carga de mundo y jugador, movimiento, animaciones, combate, F3, F6, terreno y cielo
- [ ] Revisar consola sin errores

## Riesgos y Plan de Rollback

- **Riesgo:** Imports rotos si algún path antiguo quedó referenciado. Mitigación: búsqueda de `api/`, `core/`, `interfaces/`, `utils/` en código.
- **Rollback:** Revertir commit del PR y volver a desplegar la versión anterior del frontend.

## Notas Adicionales

- La carpeta `api/` fue eliminada por completo; todos los consumidores usan adapters HTTP inyectados vía ports.
- ECS: systems se importan desde `rendering/ecs/domains/*/systems/`; index de ecs re-exporta core, components, domains y factories.
