# JDG-068 - Completar Hexagonal al 100%: ports formales, domain centralizado e inyección TerrainManager

## Resumen
Pequeña entrega para formalizar la arquitectura frontend alineada con el patrón hexagonal + DDD. Incluye:
- Contratos JSDoc para los ports (particlesApi, bloquesApi, charactersApi, celestialApi, agrupacionesApi).
- Documentación que confirma que `TerrainManager` recibe los ports inyectados desde el bootstrap (App <- createPortsAndStore()).
- Añadido JSDoc `@implements` en los adapters HTTP para referenciar los contratos.
- Centralización de modelos de dominio: implementación pura de `Viewport` en `domain/`, reexport y adaptación en `rendering/terrain/components/viewport.js`.
- Pequeñas mejoras en READMEs y docs relacionados.
- Correcciones de config (añadido VIEWPORT_MAX_CELLS) y refactor menor para asegurar compatibilidad.

## Motivación
Hacer explícitos los contratos entre infraestructura (adapters) y lógica de aplicación (App, TerrainManager, systems), facilitar futuras migraciones a TypeScript/monorepo y mejorar mantenibilidad al separar modelos de dominio puros de la capa de rendering/UI.

## Cambios principales (lista de alto nivel)
- `frontend/src/ports/contracts.js` — nuevos typedefs JSDoc (ParticlesPort, BloquesPort, CharactersPort, CelestialPort, AgrupacionesPort).
- `frontend/src/ports/README.md` — referencia a los contratos.
- `frontend/src/adapters/http/*.js` — añadido `@implements` JSDoc en los adapters HTTP (HttpParticlesApi, HttpBloquesApi, HttpCharactersApi, HttpCelestialApi, HttpAgrupacionesApi).
- `frontend/src/rendering/terrain/manager.js` — documentación del constructor señalando los ports inyectados y nota de arquitectura.
- `frontend/src/rendering/terrain/README.md` — sección "Inyección de Ports".
- `frontend/src/domain/world/viewport.js` — implementación pura de Viewport (módulo de dominio).
- `frontend/src/rendering/terrain/components/viewport.js` — reexport/adaptador que inyecta constantes de config para rendering.
- `frontend/src/domain/index.js` — reexports principales de domain.
- `frontend/src/config/particle-optimization-config.js` — añadido `VIEWPORT_MAX_CELLS`.

## Archivos modificados/creados
- Created: `frontend/src/ports/contracts.js`
- Updated: `frontend/src/ports/README.md`
- Updated: `frontend/src/adapters/http/http-particles.js`
- Updated: `frontend/src/adapters/http/http-bloques.js`
- Updated: `frontend/src/adapters/http/http-characters.js`
- Updated: `frontend/src/adapters/http/http-celestial.js`
- Updated: `frontend/src/adapters/http/http-agrupaciones.js`
- Updated: `frontend/src/rendering/terrain/manager.js`
- Updated: `frontend/src/rendering/terrain/README.md`
- Created: `frontend/src/domain/world/viewport.js`
- Updated: `frontend/src/rendering/terrain/components/viewport.js`
- Created: `frontend/src/domain/index.js`
- Updated: `frontend/src/domain/README.md`
- Updated: `frontend/src/config/particle-optimization-config.js`

## Plan de verificación (qué probar antes de merge)
1. Abrir app en entorno dev (o Docker) y verificar que no haya 404 de módulos (Network tab).
2. Verificar que TerrainManager carga dimensión y partículas sin errores (console).
3. Probar inputs básicos: movimiento, salto, combate; confirmar que no hay errores de input (isKeyDown/isMouseButtonDown).
4. Comprobar que adapters HTTP siguen funcionando (getParticles, getParticleTypes, getDimensions, getCharacter, etc.).
5. Revisar logs de debug para confirmar que el flujo bootstrap → App → TerrainManager usa los ports inyectados.

## Notas de implementación / riesgos
- Cambios mayormente documentales y de reorganización; riesgo bajo.
- Si el proyecto pasa a TypeScript, los typedefs JSDoc facilitan la migración.
- Se añadió `VIEWPORT_MAX_CELLS` en config; comprobar que no existe duplicado en otros archivos de config.

## Checklist pre-merge
- [ ] Revisar los cambios de `ports/contracts.js` y confirmar que los adapters cumplen las firmas esperadas.
- [ ] Hacer hard-refresh en el navegador para evitar caché de módulos.
- [ ] Revisar `instructions/tasks/JDG-068-action-plan_2026-02-02_23-46-07.md` para confirmación de pasos completados.
- [ ] (Opcional) Ejecutar una revisión rápida de docs `docs/frontend-estructura-elegida.md` y README principal.

## PR título sugerido
feat(frontend): formalizar ports y centralizar domain (JDG-068)

## Descripción breve (para PR body)
Este PR formaliza contratos de ports en el frontend, documenta la inyección de ports en TerrainManager, y centraliza modelos de dominio (Viewport) en `domain/`. No cambia la API pública ni la lógica de renderado; prepara la base para migración a TypeScript y mejora la separación de responsabilidades.

--- 
Generated: 2026-02-07_16-21-06

