# JDG-023 - Sistema de Ambiente y Natación

## Descripción de la Tarea

Implementar sistema de detección de agua y estados de animación para natación (`swim`, `swim_idle`).

**Comportamiento actual:**
- No hay detección de agua.
- No hay estados de natación.

**Comportamiento esperado:**
- Detección de agua funcional.
- Estados `swim` y `swim_idle` funcionales.

## Criterios de Aceptación

1. ✅ Sistema de detección de agua funciona.
2. ✅ Estado `swim` se activa en agua con movimiento.
3. ✅ Estado `swim_idle` se activa en agua sin movimiento.
4. ✅ Transiciones suaves.

## Contexto del Proyecto

### Proyecto(s) Afectado(s)
- [x] Frontend (Three.js)

### Tecnologías Involucradas
- JavaScript ES6+
- ECS
- Three.js

## Pasos de Implementación

### Paso 1: Analizar y Planificar Sistema de Detección de Agua

**Descripción:**
Decidir implementación: por posición Z o por tipo de partícula.

**Decisión:**
- Opción recomendada: Por tipo de partícula.
- Alternativa temporal: Por posición Z.

---

### Paso 2: Implementar Detección de Agua en PhysicsComponent o EnvironmentComponent

**Descripción:**
Agregar propiedad `isInWater` para detectar cuando el personaje está en agua.

**Archivos a modificar:**
- `frontend/src/ecs/components/physics.js` (Opción A)
- `frontend/src/ecs/components/environment.js` (Opción B - nuevo)

**Detalles:**
Empezar agregando `isInWater` a `PhysicsComponent`.

---

### Paso 3: Implementar Lógica de Detección de Agua en CollisionSystem

**Descripción:**
Modificar `CollisionSystem` para actualizar `isInWater`.

**Archivos a modificar:**
- `frontend/src/ecs/systems/collision-system.js`

**Detalles:**
Detectar colisión con partículas de agua o verificar posición Z.

---

### Paso 4: Agregar Condición de Agua para Estados de Animación

**Descripción:**
Crear `WaterCondition`.

**Archivos a crear:**
- `frontend/src/ecs/animation/conditions/water-condition.js`

**Archivos a modificar:**
- `frontend/src/ecs/animation/conditions/condition-factory.js`
- `frontend/src/ecs/animation/conditions/index.js`

---

### Paso 5: Configurar Estados de Natación en animation-config.js

**Descripción:**
Agregar estados `swim` y `swim_idle`.

**Archivos a modificar:**
- `frontend/src/ecs/animation/config/animation-config.js`

**Detalles:**
```javascript
{
    id: 'swim',
    priority: 7.5,
    conditions: [
        { type: 'water', operator: 'isInWater' },
        { type: 'movement', operator: 'hasMovement' }
    ],
    animation: 'swimming_to_edge',
    interruptOnInputRelease: true,
    transitions: ['swim_idle', 'idle']
},
{
    id: 'swim_idle',
    priority: 7.5,
    conditions: [
        { type: 'water', operator: 'isInWater' },
        { type: 'movement', operator: 'noMovement' }
    ],
    animation: 'swim_idle',
    transitions: ['swim', 'idle']
}
```

---

### Paso 6: Actualizar AnimationStateSystem

**Descripción:**
Asegurar que `physics` esté en el contexto de evaluación de condiciones.

**Archivos a revisar:**
- `frontend/src/ecs/systems/animation-state-system.js`

---

### Paso 7: Testing Manual

**Escenarios:**
1. Entrar al agua -> `swim`/`swim_idle`.
2. Moverse en agua -> `swim`.
3. Quieto en agua -> `swim_idle`.
4. Salir del agua.

---

### Paso Final: Generar Descripción del Pull Request

**Comando:**
`@pr-description.mdc`
