# JDG-029-2 - Migraci√≥n: lightAttack ‚Üí attack

## Descripci√≥n de la Tarea

Migrar el ID de acci√≥n `'lightAttack'` a `'attack'` para corregir un bug en el sistema de combos, eliminar duplicaci√≥n innecesaria de constantes, y simplificar el c√≥digo.

**Comportamiento actual:**
- `COMBAT_ACTIONS` usa `id: 'lightAttack'` pero `inputAction: 'attack'`
- `combo-system.js` pasa `'lightAttack'` al `ComboManager`, pero los combos esperan `'attack'`
- Existe duplicaci√≥n entre `ACTION_IDS` y `INPUT_ACTION_NAMES` (casi todos iguales)
- Los combos NO se activan porque `'lightAttack' !== 'attack'`

**Comportamiento esperado:**
- `COMBAT_ACTIONS` usa `id: 'attack'` (consistente con `inputAction`)
- `combo-system.js` pasa `'attack'` al `ComboManager` (combos funcionan)
- `INPUT_ACTION_NAMES` se elimina (duplicaci√≥n innecesaria)
- `ACTION_IDS.LIGHT_ATTACK` se renombra a `ACTION_IDS.ATTACK`
- Todo el c√≥digo usa `'attack'` consistentemente

## Criterios de Aceptaci√≥n

1. ‚úÖ `COMBAT_ACTIONS.lightAttack` renombrado a `COMBAT_ACTIONS.attack`
2. ‚úÖ `COMBAT_ACTIONS.attack.id` = `'attack'` (antes era `'lightAttack'`)
3. ‚úÖ `COMBAT_CONSTANTS.ACTION_IDS.LIGHT_ATTACK` renombrado a `ATTACK`
4. ‚úÖ `INPUT_ACTION_NAMES` eliminado (duplicaci√≥n innecesaria)
5. ‚úÖ `combo-system.js` usa `COMBAT_CONSTANTS.ACTION_IDS.ATTACK` en lugar de `LIGHT_ATTACK`
6. ‚úÖ `weapon-animations-config.js` actualizado: key `lightAttack` ‚Üí `attack`
7. ‚úÖ Todos los usos de `'lightAttack'` reemplazados por `'attack'`
8. ‚úÖ Los combos funcionan correctamente
9. ‚úÖ El ataque b√°sico funciona igual que antes
10. ‚úÖ No hay referencias hardcodeadas a `'lightAttack'` restantes

## Contexto del Proyecto

### Proyecto(s) Afectado(s)
- [x] Frontend (Three.js)
- [ ] Backend (FastAPI)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura

### Tecnolog√≠as Involucradas
- Frontend: JavaScript ES6+
- Sistema ECS (Entity Component System)
- Sistema de combate y combos

## Pasos de Implementaci√≥n

### Paso 1: Actualizar `combat-actions-config.js`

**Descripci√≥n:**
Renombrar la key `lightAttack` a `attack` y cambiar su `id` de `'lightAttack'` a `'attack'`.

**Archivos a modificar:**
- `frontend/src/config/combat-actions-config.js`

**Detalles de implementaci√≥n:**
```javascript
// Antes
lightAttack: {
    id: 'lightAttack',
    inputAction: 'attack',
    animationStateId: 'attack',
    attackType: 'light',
    // ...
},

// Despu√©s
attack: {
    id: 'attack',
    inputAction: 'attack',
    animationStateId: 'attack',
    attackType: 'light',
    // ...
},
```

**Notas:**
- Cambiar la key del objeto (afecta `Object.entries()` en `combat-system.js`)
- Cambiar el `id` interno
- `inputAction` y `animationStateId` ya eran `'attack'`, no cambiar
- `attackType: 'light'` sigue igual (diferencia el tipo)

---

### Paso 2: Actualizar `combat-constants.js`

**Descripci√≥n:**
Renombrar `LIGHT_ATTACK` a `ATTACK` y eliminar `INPUT_ACTION_NAMES` (duplicaci√≥n innecesaria).

**Archivos a modificar:**
- `frontend/src/config/combat-constants.js`

**Detalles de implementaci√≥n:**
```javascript
// Antes
ACTION_IDS: {
    PARRY: 'parry',
    DODGE: 'dodge',
    SPECIAL_ATTACK: 'specialAttack',
    HEAVY_ATTACK: 'heavyAttack',
    CHARGED_ATTACK: 'chargedAttack',
    LIGHT_ATTACK: 'lightAttack',
},
INPUT_ACTION_NAMES: {
    ATTACK: 'attack',
    DODGE: 'dodge',
    PARRY: 'parry',
    SPECIAL_ATTACK: 'specialAttack',
    HEAVY_ATTACK: 'heavyAttack',
    CHARGED_ATTACK: 'chargedAttack',
},

// Despu√©s
ACTION_IDS: {
    ATTACK: 'attack',           // ‚Üê Renombrado de LIGHT_ATTACK
    PARRY: 'parry',
    DODGE: 'dodge',
    SPECIAL_ATTACK: 'specialAttack',
    HEAVY_ATTACK: 'heavyAttack',
    CHARGED_ATTACK: 'chargedAttack',
},
// INPUT_ACTION_NAMES eliminado (eran todos iguales a ACTION_IDS excepto ATTACK vs LIGHT_ATTACK)
```

**Notas:**
- Renombrar `LIGHT_ATTACK` a `ATTACK`
- Eliminar completamente `INPUT_ACTION_NAMES` (ya no necesario)
- Actualizar comentarios si es necesario

---

### Paso 3: Actualizar `combo-system.js`

**Descripci√≥n:**
Actualizar para usar `COMBAT_CONSTANTS.ACTION_IDS.ATTACK` en lugar de `LIGHT_ATTACK`.

**Archivos a modificar:**
- `frontend/src/ecs/systems/combo-system.js`

**Detalles de implementaci√≥n:**
```javascript
// Antes
if (input.wantsToAttack) {
    inputType = COMBAT_CONSTANTS.ACTION_IDS.LIGHT_ATTACK;
}

// Despu√©s
if (input.wantsToAttack) {
    inputType = COMBAT_CONSTANTS.ACTION_IDS.ATTACK;
}
```

**Notas:**
- Solo un cambio necesario en l√≠nea 80
- Ahora pasar√° `'attack'` al ComboManager (combos funcionar√°n)

---

### Paso 4: Actualizar `combat-system.js`

**Descripci√≥n:**
Actualizar `checkActionInput` para usar `COMBAT_CONSTANTS.ACTION_IDS.ATTACK` en lugar de `INPUT_ACTION_NAMES.ATTACK`.

**Archivos a modificar:**
- `frontend/src/ecs/systems/combat-system.js`

**Detalles de implementaci√≥n:**
```javascript
// Antes
case COMBAT_CONSTANTS.INPUT_ACTION_NAMES.ATTACK:
    return input.wantsToAttack;

// Despu√©s
case COMBAT_CONSTANTS.ACTION_IDS.ATTACK:
    return input.wantsToAttack;
```

**Notas:**
- Cambiar solo el case que usa `INPUT_ACTION_NAMES.ATTACK`
- Los dem√°s cases ya usan `ACTION_IDS` (no cambiar)

---

### Paso 5: Actualizar `weapon-animations-config.js`

**Descripci√≥n:**
Renombrar la key `lightAttack` a `attack` en todas las armas.

**Archivos a modificar:**
- `frontend/src/config/weapon-animations-config.js`

**Detalles de implementaci√≥n:**
```javascript
// Antes
'sword': {
    lightAttack: 'left_slash',
    // ...
},
'axe': {
    lightAttack: 'attack',
    // ...
},
// ... etc

// Despu√©s
'sword': {
    attack: 'left_slash',  // ‚Üê Renombrado
    // ...
},
'axe': {
    attack: 'attack',  // ‚Üê Renombrado
    // ...
},
// ... etc
```

**Notas:**
- Cambiar key `lightAttack` a `attack` en todas las armas (sword, axe, hammer, spear, generic)
- Mantener los valores de animaci√≥n iguales

---

### Paso 6: Buscar y actualizar referencias en otros archivos

**Descripci√≥n:**
Buscar cualquier referencia restante a `'lightAttack'` o `LIGHT_ATTACK` en el c√≥digo.

**Archivos a verificar:**
- Todos los archivos del frontend
- READMEs y documentaci√≥n

**Comandos a ejecutar:**
```bash
# Buscar referencias a lightAttack
grep -r "lightAttack" frontend/src/
grep -r "LIGHT_ATTACK" frontend/src/

# Buscar referencias en READMEs
grep -r "lightAttack" juego-de-dioses/instructions/
```

**Detalles de implementaci√≥n:**
- Buscar todas las referencias
- Actualizar seg√∫n corresponda:
  - Si es un string literal `'lightAttack'` ‚Üí `'attack'`
  - Si es una constante `LIGHT_ATTACK` ‚Üí `ATTACK`
  - Si es en documentaci√≥n, actualizar para reflejar el cambio

**Notas:**
- Revisar especialmente `ecs/animation/README.md` que mencionaba `lightAttack`
- Verificar si hay referencias en comentarios o documentaci√≥n

---

### Paso 7: Verificar que no hay referencias hardcodeadas

**Descripci√≥n:**
Verificar exhaustivamente que no quedan referencias a `'lightAttack'` o `LIGHT_ATTACK` en el c√≥digo.

**Comandos a ejecutar:**
```bash
# Buscar strings hardcodeados
grep -r "'lightAttack'" frontend/src/
grep -r '"lightAttack"' frontend/src/
grep -r 'lightAttack' frontend/src/

# Buscar constantes
grep -r "LIGHT_ATTACK" frontend/src/
grep -r "INPUT_ACTION_NAMES" frontend/src/
```

**Notas:**
- Los resultados deben mostrar solo comentarios o documentaci√≥n (que se actualizaron)
- Si hay referencias en c√≥digo, agregarlas al paso correspondiente

---

### Paso 8: Verificar errores de lint

**Descripci√≥n:**
Verificar que todos los archivos modificados pasan el lint sin errores.

**Archivos a verificar:**
- `frontend/src/config/combat-actions-config.js`
- `frontend/src/config/combat-constants.js`
- `frontend/src/ecs/systems/combo-system.js`
- `frontend/src/ecs/systems/combat-system.js`
- `frontend/src/config/weapon-animations-config.js`

**Notas:**
- Todos los archivos deben compilar sin errores
- Revisar consola del navegador por warnings o errores

---

### Paso 9: Testing b√°sico de funcionalidad

**Descripci√≥n:**
Verificar que todas las funcionalidades siguen funcionando correctamente despu√©s de los cambios.

**Escenarios a verificar:**
1. ‚úÖ El ataque b√°sico funciona (click izquierdo)
2. ‚úÖ Los combos se activan correctamente (secuencia de ataques)
3. ‚úÖ El sistema de cooldowns funciona para el ataque
4. ‚úÖ Las animaciones de ataque funcionan
5. ‚úÖ Las animaciones por tipo de arma funcionan (sword, axe, etc.)
6. ‚úÖ No hay errores en consola del navegador

**Notas:**
- Testing manual b√°sico para verificar que no hay regresiones
- Enfocarse especialmente en combos (que deber√≠an funcionar ahora)

---

### Paso Final: Generar Descripci√≥n del Pull Request

**Descripci√≥n:**
Una vez completados todos los pasos anteriores y verificada la implementaci√≥n, genera la descripci√≥n completa del Pull Request usando la regla `@pr-description.mdc`.

**Comando a ejecutar:**
```
@pr-description.mdc
```

**Resultado esperado:**
- Archivo generado: `JDG-029-2_pr-description_[FECHA-HORA].md` en `/instructions/prs/` (con fecha y hora obtenida de `Get-Date -Format "yyyy-MM-dd_HH-mm-ss"`)
- El archivo contendr√° una descripci√≥n completa del PR lista para copiar y pegar en Git
- Incluir√°: t√≠tulo, resumen, motivaci√≥n, cambios t√©cnicos, testing, referencias y riesgos

**Notas:**
- Este paso se ejecuta DESPU√âS de completar toda la implementaci√≥n
- La descripci√≥n se genera autom√°ticamente bas√°ndose en los cambios realizados
- El desarrollador solo necesita copiar y pegar el contenido en Git
- No editar manualmente a menos que sea estrictamente necesario

---

## Consideraciones T√©cnicas

### Performance
- ‚úÖ Cero impacto de performance - Solo cambios de nombres de strings
- ‚úÖ No hay overhead adicional
- ‚úÖ Mismo comportamiento en runtime

### Seguridad
- ‚úÖ No hay cambios de seguridad - Solo refactoring de nombres
- ‚úÖ Valores son equivalentes, solo cambi√≥ el nombre

### Compatibilidad
- ‚úÖ No rompe funcionalidad existente - Los valores son equivalentes
- ‚úÖ Cambios son puramente de renombrado
- ‚úÖ Comportamiento funcional id√©ntico

### Casos Edge
- ‚úÖ Verificar que cooldowns funcionan con el nuevo nombre
- ‚úÖ Verificar que los combos se activan correctamente (bug corregido)
- ‚úÖ Verificar que las animaciones por arma funcionan

## Patrones de C√≥digo a Usar

- **Renombrado consistente**: Cambiar todos los usos del nombre antiguo al nuevo
- **B√∫squeda exhaustiva**: Buscar todas las referencias antes de cambiar
- **Testing despu√©s de cada cambio**: Verificar que no se rompi√≥ nada

## Dependencias

### Nuevas Dependencias
- Ninguna

### Variables de Entorno
- Ninguna

## Archivos Principales Involucrados

1. `frontend/src/config/combat-actions-config.js` - Key y `id` de `lightAttack` ‚Üí `attack`
2. `frontend/src/config/combat-constants.js` - `LIGHT_ATTACK` ‚Üí `ATTACK`, eliminar `INPUT_ACTION_NAMES`
3. `frontend/src/ecs/systems/combo-system.js` - Usar `ACTION_IDS.ATTACK` en lugar de `LIGHT_ATTACK`
4. `frontend/src/ecs/systems/combat-system.js` - Usar `ACTION_IDS.ATTACK` en lugar de `INPUT_ACTION_NAMES.ATTACK`
5. `frontend/src/config/weapon-animations-config.js` - Key `lightAttack` ‚Üí `attack` en todas las armas

## Testing

### Tests a Verificar
- Verificar que el ataque b√°sico funciona
- Verificar que los combos se activan correctamente (BUG CORREGIDO)
- Verificar que las animaciones funcionan
- Verificar que los cooldowns funcionan
- Verificar que las animaciones por arma funcionan

### Escenarios de Prueba
1. Ataque b√°sico: Click izquierdo debe ejecutar ataque
2. Combos: Secuencia de ataques debe activar combos (antes no funcionaba)
3. Animaciones: Las animaciones deben reproducirse correctamente
4. Armas: Diferentes armas deben usar sus animaciones correctas

## Deployment

### Orden de Deployment
1. Frontend: Los cambios son solo en JavaScript, no requieren rebuild especial
2. Verificar que el frontend carga correctamente en el navegador
3. Verificar que no hay errores en consola del navegador

### Verificaci√≥n Post-Deployment
- [ ] Verificar frontend en navegador
- [ ] Verificar que el ataque b√°sico funciona
- [ ] Verificar que los combos funcionan (BUG CORREGIDO)
- [ ] Verificar que no hay errores en consola del navegador
- [ ] Verificar que las animaciones funcionan correctamente
- [ ] Verificar logs de Docker (si hay errores)

---

**Nota Final:** Este plan debe ejecutarse paso a paso, verificando cada paso antes de continuar con el siguiente. Si encuentras problemas o necesitas clarificaci√≥n, consulta con el equipo antes de proceder.

**‚ö†Ô∏è IMPORTANTE:** El √∫ltimo paso del plan SIEMPRE debe ser "Generar Descripci√≥n del Pull Request" usando `@pr-description.mdc`. Esto genera autom√°ticamente la descripci√≥n completa del PR lista para Git.

**üîß Bug corregido:** Este cambio corrige el bug donde los combos no se activaban porque `combo-system.js` pasaba `'lightAttack'` pero los combos esperaban `'attack'`.

