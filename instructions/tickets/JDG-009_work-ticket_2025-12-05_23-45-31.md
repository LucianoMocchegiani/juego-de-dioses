# JDG-009 - Crear Terreno de Prueba para Primer Humano

## Tipo
- [x] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [ ] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [x] Alta (bloquea funcionalidad crítica)
- [ ] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

Se necesita crear un terreno de prueba específico para poder crear el primer humano del juego. Este terreno debe ser simple, plano y contener los elementos básicos necesarios: tierra, hierba, un lago y 10 árboles distribuidos en un área de 40x40 metros.

### Comportamiento Actual

Actualmente existe un demo de bioma bosque 40x40m (`seed_demo.py`) que genera un terreno complejo con muchas partículas, árboles distribuidos aleatoriamente y un acuífero subterráneo. Este terreno es demasiado complejo para las pruebas iniciales de creación de humanos.

### Comportamiento Esperado

**Terreno de prueba 40x40m con:**
- **Terreno plano**: Sin elevaciones, completamente plano en z=0
- **Capa base de tierra**: Capas de tierra sólida bajo la superficie (z=-3 a z=-1)
- **Capa base de piedra**: Capa de piedra en z=-4 como base sólida
- **Superficie de hierba**: Hierba cubriendo toda la superficie (z=0)
- **Un lago**: Área de agua en superficie (z=0 y z=1) de tamaño moderado (ej: 8x8 metros)
- **10 árboles**: Exactamente 10 árboles distribuidos estratégicamente en el terreno, evitando el lago
- **Sin acuífero subterráneo**: Terreno simple sin sistemas de agua subterránea

**Finalidad:**
- Terreno de prueba para crear el primer humano
- Terreno simple y controlado para facilitar pruebas
- Recursos básicos disponibles (agua del lago, madera de árboles)

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI) - No afectado directamente
- [ ] Frontend (Three.js) - No afectado directamente
- [x] Base de Datos (PostgreSQL) - Creación de nueva dimensión y partículas
- [ ] Cache (Redis) - No afectado
- [ ] Docker/Infraestructura - No afectado

### Tecnologías Involucradas
- Python 3.11
- asyncpg (para consultas a PostgreSQL)
- Sistema de builders (TreeBuilder, EntityCreator)
- Plantillas de árboles existentes

### Archivos/Componentes Principales

**Archivos a crear/modificar:**
- `backend/src/database/seed_human_test.py` (nuevo) - Script para crear terreno de prueba
- Posiblemente: `backend/src/database/seed_demo.py` - Como referencia

**Componentes a usar:**
- `backend/src/database/builders/tree_builder.py` - Para crear árboles
- `backend/src/database/creators/entity_creator.py` - Para crear entidades
- `backend/src/database/terrain_builder.py` - Para crear capas base de terreno
- Plantillas de árboles existentes

## Criterios de Aceptación

1. [ ] Terreno de prueba creado con dimensión 40x40 metros
2. [ ] Terreno completamente plano (sin elevaciones)
3. [ ] Capa base de piedra en z=-4 cubriendo todo el área
4. [ ] Capas de tierra en z=-3, z=-2, z=-1 cubriendo todo el área
5. [ ] Superficie de hierba en z=0 cubriendo todo el área (excepto donde está el lago)
6. [ ] Un lago de agua creado en superficie (z=0 y z=1) de tamaño apropiado (8x8 metros aproximadamente)
7. [ ] Exactamente 10 árboles creados y distribuidos en el terreno
8. [ ] Árboles no se superponen con el lago
9. [ ] Árboles distribuidos de forma visible y accesible
10. [ ] Terreno se puede cargar desde el frontend correctamente
11. [ ] Script de seed es ejecutable y crea el terreno de forma reproducible
12. [ ] Documentación del terreno creada (ubicación, cómo ejecutarlo)

## Detalles de Implementación

### Consideraciones Técnicas

**Estructura del terreno:**
- **Tamaño**: 40x40 metros
- **Tamaño de celda**: 0.1m (400x400 celdas)
- **Profundidad**: z=-4 a z=1 (suficiente para terreno plano)
- **Capa base (z=-4)**: Piedra sólida
- **Subsuelo (z=-3 a z=-1)**: Tierra
- **Superficie (z=0)**: Hierba (excepto lago)
- **Lago (z=0 y z=1)**: Agua líquida en área específica

**Distribución del lago:**
- Tamaño: 8x8 metros (80x80 celdas)
- Posición: Centrado o en una esquina del terreno (ej: x=10-18m, y=10-18m)
- Profundidad: 2 niveles (z=0 y z=1) para que sea visible
- Forma: Cuadrado o circular

**Distribución de árboles:**
- Cantidad exacta: 10 árboles
- Espaciado mínimo: 4-5 metros entre árboles
- Evitar área del lago
- Distribución: Esparcidos por el terreno pero accesibles
- Usar plantillas de árboles existentes (variedad de tamaños)

**Performance:**
- Terreno simple con menos partículas que el demo actual
- Sin sistemas complejos (acuíferos, múltiples capas de agua)
- Optimizado para carga rápida

**Compatibilidad:**
- Usar mismo sistema de builders y creators que el demo actual
- Compatible con sistema de renderizado del frontend
- Usar tipos de partículas existentes (tierra, hierba, piedra, agua, madera, hojas)

**Escalabilidad:**
- Script debe ser fácil de modificar para cambiar tamaño o distribución
- Preparado para futuras extensiones (más elementos, diferentes configuraciones)

### Pasos de Implementación

**1. Crear script de seed:**
```python
# backend/src/database/seed_human_test.py
async def seed_human_test():
    """
    Crear terreno de prueba 40x40m para crear el primer humano.
    
    Estructura:
    - Terreno plano con tierra y hierba
    - Un lago de agua en superficie
    - 10 árboles distribuidos estratégicamente
    """
    # 1. Crear dimensión 40x40m
    # 2. Crear capa base de piedra (z=-4)
    # 3. Crear capas de tierra (z=-3 a z=-1)
    # 4. Crear superficie de hierba (z=0)
    # 5. Crear lago de agua (z=0 y z=1, área específica)
    # 6. Crear 10 árboles distribuidos
    # 7. Verificar y mostrar estadísticas
```

**2. Definir posición del lago:**
- Coordenadas específicas (ej: centro del terreno o esquina)
- Tamaño fijo (8x8 metros)
- Forma (cuadrado o circular)

**3. Generar posiciones de árboles:**
- Algoritmo para distribuir 10 árboles
- Verificar que no se superpongan con el lago
- Espaciado mínimo entre árboles
- Usar plantillas de árboles existentes

**4. Integrar con sistema existente:**
- Usar `EntityCreator` para crear árboles
- Usar `TreeBuilder` con plantillas
- Usar funciones de `terrain_builder.py` para capas base

**5. Agregar comando de ejecución:**
- Script ejecutable desde línea de comandos
- Opción para limpiar terreno anterior si existe
- Logs claros del proceso

### Dependencias

- Depende de: JDG-006 (Componentización del Frontend) - Para renderizar el terreno
- Depende de: Sistema de builders y creators existente
- Bloquea: Tickets futuros de creación de humanos (necesita terreno de prueba)

## Testing

### Escenarios de Prueba

1. **Creación del terreno:**
   - Ejecutar script de seed
   - Verificar que se crea la dimensión correctamente
   - Verificar que todas las capas se crean (piedra, tierra, hierba)
   - Verificar que el lago se crea en la posición correcta
   - Verificar que se crean exactamente 10 árboles

2. **Carga desde frontend:**
   - Cargar terreno desde el frontend
   - Verificar que se renderiza correctamente
   - Verificar que el lago es visible
   - Verificar que los árboles se renderizan
   - Verificar que el terreno es plano

3. **Distribución de elementos:**
   - Verificar que los árboles no se superponen con el lago
   - Verificar que los árboles están distribuidos en el terreno
   - Verificar que el lago tiene el tamaño correcto
   - Verificar que la superficie es completamente plana

4. **Recursos disponibles:**
   - Verificar que hay agua en el lago (partículas de agua)
   - Verificar que hay madera en los árboles (partículas de madera)
   - Verificar que hay hierba en la superficie
   - Verificar que hay tierra en el subsuelo

5. **Reproducibilidad:**
   - Ejecutar script múltiples veces
   - Verificar que el resultado es consistente (mismo lago, mismos árboles)
   - Verificar que se puede limpiar y recrear

### Casos Edge a Considerar

- Terreno ya existe (limpiar o actualizar)
- Árboles muy cerca del lago (verificar espaciado)
- Árboles en los bordes del terreno (verificar límites)
- Lago muy grande o muy pequeño (verificar tamaño)
- Script ejecutado múltiples veces (idempotencia)

## Estimación

- **Complejidad:** Media
- **Tiempo estimado:** 6-8 horas
- **Notas:** 
  - Basado en el script `seed_demo.py` existente
  - Requiere ajustar distribución de árboles y crear lago
  - Requiere pruebas de renderizado en frontend
  - Puede requerir ajustes finos en posicionamiento

## Referencias

- **Relacionado con:** JDG-006 (Componentización del Frontend) - Para renderizar
- **Documentación relevante:**
  - `backend/src/database/seed_demo.py` - Script de referencia
  - `backend/src/database/builders/tree_builder.py` - Para crear árboles
  - `backend/src/database/creators/entity_creator.py` - Para crear entidades
  - `backend/src/database/terrain_builder.py` - Para crear capas base
  - `instructions/examples/terrenos/` - Ejemplos de terrenos
- **Discusiones previas:** Necesidad identificada para crear el primer humano

## Notas Adicionales

- El terreno debe ser simple y controlado para facilitar pruebas
- El lago debe ser accesible y visible para pruebas de interacción con agua
- Los árboles deben estar distribuidos de forma que sean fáciles de encontrar y acceder
- El script debe ser fácil de ejecutar y documentado
- Considerar agregar un endpoint de API para ejecutar el seed desde el frontend (opcional)
- El terreno puede ser usado como base para futuros terrenos de prueba más complejos

