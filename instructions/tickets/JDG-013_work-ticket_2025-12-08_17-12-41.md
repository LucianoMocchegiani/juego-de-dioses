# JDG-013 - Reemplazar Modelo de Personaje con Human.glb

## Tipo
- [x] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [ ] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [ ] Alta (bloquea funcionalidad crítica)
- [x] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

Se ha creado un nuevo modelo humanoide (`Human.glb`) con estilo voxel/low-poly que incluye vertex groups para el sistema de daño por partes (head, torso, left_arm, right_arm, left_leg, right_leg). Este modelo debe reemplazar los modelos de prueba actuales (duck.glb, humano_test.glb) para ser usado como personaje principal en el juego.

El modelo `Human.glb` ya está disponible en `backend/static/models/characters/Human.glb` y tiene las siguientes características:
- Estilo voxel/low-poly que coincide con el mundo de partículas
- 905 caras (optimizado desde 246k)
- Vertex groups: head, torso, left_arm, right_arm, left_leg, right_leg
- T-pose para fácil animación
- Formas geométricas variadas (cubos, cilindros, prismas)

### Comportamiento Actual

- Los personajes usan modelos de prueba (duck.glb, humano_test.glb, etc.)
- El script `seed_character_with_model.py` crea personajes con `humano_test.glb`
- No hay un modelo humanoide principal definido para el juego
- Los modelos de prueba no tienen vertex groups preparados para sistema de daño por partes

### Comportamiento Esperado

- El modelo `Human.glb` se usa como modelo principal para personajes humanos
- Los personajes nuevos se crean con `Human.glb` por defecto
- El modelo se renderiza correctamente en el juego
- Los vertex groups están disponibles para futura implementación del sistema de daño por partes
- El modelo tiene escala y posición correctas en el mundo del juego

## Contexto Técnico

### Componentes Afectados
- [x] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura
- [ ] API Endpoints
- [ ] WebSockets

### Tecnologías Involucradas
- Python 3.11, FastAPI, asyncpg
- Three.js, JavaScript ES6+, GLTFLoader
- PostgreSQL 16 (campo modelo_3d en agrupaciones)
- Blender (para verificación de vertex groups)

### Archivos/Componentes Principales
- `backend/src/database/seed_character_with_model.py` - Script para crear personajes con modelo
- `backend/src/database/builders/biped_builder.py` - Builder que asocia modelos a personajes
- `backend/src/models/schemas.py` - Schema Model3D
- `frontend/src/ecs/factories/player-factory.js` - Factory que carga modelos 3D
- `frontend/src/renderers/models/model-utils.js` - Utilidades de carga de modelos
- `backend/static/models/characters/Human.glb` - Modelo nuevo

## Criterios de Aceptación

1. [ ] El modelo `Human.glb` está disponible en `backend/static/models/characters/`
2. [ ] Se puede crear un personaje con `Human.glb` usando el script de seed
3. [ ] El modelo se carga correctamente en el frontend
4. [ ] El modelo se renderiza correctamente en Three.js con escala y posición adecuadas
5. [ ] Los vertex groups están presentes en el modelo cargado (verificación en Three.js)
6. [ ] El modelo reemplaza los modelos de prueba como modelo principal
7. [ ] El script `seed_character_with_model.py` usa `Human.glb` por defecto
8. [ ] El modelo tiene escala apropiada (no demasiado grande ni pequeño)
9. [ ] El modelo mantiene el estilo voxel/low-poly del mundo

**Nota:** Cada criterio debe ser específico, medible y verificable.

## Detalles de Implementación

### Consideraciones Técnicas

**Escala del Modelo:**
- El modelo `Human.glb` tiene 900-1000 caras (optimizado)
- Necesita verificación de escala en el juego (puede requerir ajuste en `escala` del `modelo_3d`)
- El modelo está en T-pose, ideal para vertex groups

**Vertex Groups:**
- Los vertex groups están definidos: head, torso, left_arm, right_arm, left_leg, right_leg
- No se implementará el sistema de daño por partes en este ticket (será JDG-014)
- Solo se verifica que los vertex groups estén disponibles en el modelo cargado

**Compatibilidad:**
- Mantener compatibilidad con modelos existentes (duck.glb, humano_test.glb)
- El sistema debe funcionar con cualquier modelo GLB
- Fallback a primitivas si el modelo no se carga

### Dependencias
- Depende de: JDG-012 (Sistema de Modelos 3D para Personajes)
- Bloquea: JDG-014 (Sistema de Daño por Partes del Cuerpo)

## Testing

### Escenarios de Prueba
1. **Crear personaje con Human.glb**: Ejecutar script de seed, verificar que se crea correctamente
2. **Cargar modelo en frontend**: Verificar que el modelo se carga desde la API
3. **Renderizar modelo**: Verificar que se renderiza correctamente en Three.js
4. **Verificar escala**: Verificar que el modelo tiene tamaño apropiado (no demasiado grande/pequeño)
5. **Verificar vertex groups**: Verificar que los vertex groups están disponibles en el modelo cargado
6. **Verificar posición**: Verificar que el modelo aparece en la posición correcta del mundo

### Casos Edge a Considerar
- Modelo no encontrado → fallback a primitivas
- Escala incorrecta → ajustar escala en modelo_3d
- Vertex groups no disponibles → verificar exportación desde Blender
- Modelo demasiado grande/pequeño → ajustar escala

## Estimación

- **Complejidad:** Baja
- **Tiempo estimado:** 1-2 horas
- **Notas:** 
  - El modelo ya está creado y en la ubicación correcta
  - Solo requiere actualizar scripts y verificar renderizado
  - La mayor parte del trabajo es testing y ajuste de escala

## Referencias

- **Relacionado con:** JDG-012 (Sistema de Modelos 3D para Personajes)
- **Bloquea:** JDG-014 (Sistema de Daño por Partes del Cuerpo)
- **Documentación relevante:**
  - `GUIA-CREAR-MODELOS-PARTES-CRITICAS.md` - Guía para crear modelos con vertex groups
  - `PROMPTS-IA-MODELOS-VOXEL.md` - Prompts para generar modelos con IA
  - `backend/src/database/seed_character_with_model.py` - Script de seed
  - `frontend/src/renderers/models/README.md` - Sistema de carga de modelos

## Notas Adicionales

- El modelo `Human.glb` fue creado usando Meshy AI y optimizado en Blender
- Los vertex groups fueron creados manualmente en Blender para el sistema de daño por partes
- El modelo tiene estilo voxel/low-poly que coincide con el mundo de partículas
- Este ticket prepara el terreno para JDG-014 (sistema de daño por partes)

