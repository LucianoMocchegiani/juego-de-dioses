# JDG-023 - Refactorización Data-Driven de Sistemas Core

## Tipo
- [ ] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [x] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [ ] Alta (bloquea funcionalidad crítica)
- [x] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento
Los sistemas `AnimationStateSystem`, `InputSystem` y `AnimationMixerSystem` contienen lógica hardcodeada que depende de IDs específicos de estados o teclas. Esto dificulta la extensión del juego (agregar nuevos ataques o cambiar controles) y viola principios de diseño limpio.

### Comportamiento Actual
- `AnimationStateSystem` tiene `if`s explícitos para `'special_attack'`, `'combo_attack'`, etc.
- `InputSystem` verifica teclas específicas como `'KeyW'` directamente en el código.
- `AnimationMixerSystem` tiene algunos residuos de lógica específica.

### Comportamiento Esperado
- Los sistemas deben ser agnósticos a los IDs específicos.
- El comportamiento debe definirse completamente en archivos de configuración (`animation-config.js`, `input-map-config.js`).
- Agregar un nuevo ataque o cambiar una tecla no debe requerir tocar código `.js` de los sistemas.

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)

### Tecnologías Involucradas
- JavaScript ES6+
- ECS Architecture

### Archivos/Componentes Principales
- `frontend/src/ecs/systems/animation-state-system.js`
- `frontend/src/ecs/systems/input-system.js`
- `frontend/src/ecs/systems/animation-mixer-system.js`
- `frontend/src/ecs/config/input-map-config.js` (Nuevo)
- `frontend/src/ecs/animation/config/animation-config.js`

## Criterios de Aceptación

1. [ ] `InputSystem` usa un archivo de configuración para mapear teclas a acciones.
2. [ ] `AnimationStateSystem` no contiene referencias explícitas a IDs de estados de combate (usa tipos/categorías).
3. [ ] `AnimationMixerSystem` está limpio de lógica específica de estados (warnings hardcodeados, etc.).
4. [ ] El juego funciona exactamente igual que antes (refactor puro).

## Detalles de Implementación

### Consideraciones Técnicas
- **Extensibilidad**: El objetivo principal es facilitar la adición de contenido.
- **Performance**: El lookup de configuración debe ser eficiente (usar Maps o Sets donde corresponda).

### Dependencias
- Depende de: JDG-022 (base del sistema de animación)

## Testing

### Escenarios de Prueba
1. **Regresión**: Verificar que moverse, saltar, agacharse y atacar sigue funcionando igual.
2. **Configuración**: Cambiar una tecla en el config y verificar que el juego responde al cambio sin tocar código.
3. **Nuevos Estados**: (Teórico) Verificar que se podría agregar un nuevo tipo de ataque solo con config.

## Estimación

- **Complejidad**: Media
- **Tiempo estimado**: 4-6 horas

## Referencias

- **Relacionado con**: JDG-022
- **Documentación relevante**: `instructions/analysis/JDG-023-architecture-analysis_2025-12-10_21-23-50.md`
