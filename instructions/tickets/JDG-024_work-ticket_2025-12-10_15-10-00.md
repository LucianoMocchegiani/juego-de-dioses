# JDG-023 - Sistema de Ambiente y Natación

## Tipo
- [x] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [ ] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [x] Alta (bloquea funcionalidad crítica)
- [ ] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

El sistema actual carece de interactividad con el entorno, específicamente con el agua.
1.  **Falta de detección de agua**: No existe sistema para detectar cuando el personaje está en agua.
2.  **Falta de estados de natación**: No hay estados de animación para nadar (`swim`, `swim_idle`).

### Comportamiento Actual

- No hay detección de colisión con agua.
- No hay estados para natación.
- El personaje camina sobre el fondo del agua como si fuera tierra.

### Comportamiento Esperado

- **Detección de agua**: El sistema detecta cuando el personaje entra/sale del agua.
- **`swim`**: Se activa cuando está en agua Y hay movimiento.
- **`swim_idle`**: Se activa cuando está en agua Y NO hay movimiento.
- **EnvironmentComponent**: (Opcional) Componente para manejar estados ambientales.

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura

### Tecnologías Involucradas
- JavaScript ES6+
- ECS (Entity Component System)
- Sistema de colisiones
- Sistema de animaciones

### Archivos/Componentes Principales
- `frontend/src/ecs/components/physics.js` - Agregar `isInWater`.
- `frontend/src/ecs/systems/collision-system.js` - Detectar colisión con agua.
- `frontend/src/ecs/animation/config/animation-config.js` - Configurar estados `swim`.
- `frontend/src/ecs/animation/conditions/water-condition.js` - Nueva condición.

## Criterios de Aceptación

1. [ ] Sistema de detección de agua funciona correctamente (por tipo de partícula o posición Z).
2. [ ] Estado `swim` funciona correctamente: se activa cuando está en agua + movimiento.
3. [ ] Estado `swim_idle` funciona correctamente: se activa cuando está en agua sin movimiento.
4. [ ] Prioridades de estados correctamente configuradas (swim > walk/run).
5. [ ] Transiciones suaves al entrar/salir del agua.

## Detalles de Implementación

### Sistema de Detección de Agua
Opciones:
1.  **Por posición Z**: Si Z <= nivel del agua.
2.  **Por tipo de partícula**: Detectar colisión con partículas "agua". (Recomendado).

### Prioridades
- `swim` (7.5)
- `swim_idle` (7.5)

## Testing

### Escenarios de Prueba
1.  **Entrar al agua**: Caminar hacia el agua -> activar `swim` o `swim_idle`.
2.  **Nadar**: Moverse en el agua -> `swim`.
3.  **Flotar**: Quedarse quieto en el agua -> `swim_idle`.
4.  **Salir del agua**: Caminar fuera del agua -> volver a `walk`/`run`/`idle`.

## Estimación
- **Complejidad:** Media
- **Tiempo estimado:** 3-4 horas

## Referencias
- **Relacionado con:** JDG-022 (se separó de este ticket).
