# JDG-029-2 - Unificar lightAttack a attack para corregir bug de combos

## Tipo
- [ ] Feature (nueva funcionalidad)
- [x] Bugfix (corrección de error)
- [ ] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [x] Alta (bloquea funcionalidad crítica)
- [ ] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

Existía una inconsistencia en el sistema de combate donde `COMBAT_ACTIONS` usaba `id: 'lightAttack'` pero `inputAction: 'attack'`, mientras que `combo-system.js` pasaba `'lightAttack'` al `ComboManager`, pero los combos en `combo-config.js` esperaban `'attack'`. Esto causaba que los combos nunca se activaran porque `'lightAttack' !== 'attack'`. Además, existía duplicación innecesaria entre `ACTION_IDS` y `INPUT_ACTION_NAMES` donde todos los valores eran idénticos excepto por esta diferencia.

### Comportamiento Actual

- `COMBAT_ACTIONS.lightAttack` tiene `id: 'lightAttack'` pero `inputAction: 'attack'`
- `combo-system.js` pasa `'lightAttack'` al `ComboManager`
- Los combos en `combo-config.js` esperan `'attack'`
- Los combos nunca se activan porque `'lightAttack' !== 'attack'`
- Duplicación innecesaria entre `ACTION_IDS` y `INPUT_ACTION_NAMES`

### Comportamiento Esperado

- `COMBAT_ACTIONS.attack` tiene `id: 'attack'` (unificado)
- `combo-system.js` usa `COMBAT_CONSTANTS.ACTION_IDS.ATTACK`
- Los combos se activan correctamente porque ambos usan `'attack'`
- `INPUT_ACTION_NAMES` eliminado (duplicación innecesaria)
- Todas las referencias a `'lightAttack'` reemplazadas por `'attack'`

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura
- [ ] API Endpoints
- [ ] WebSockets

### Tecnologías Involucradas
- JavaScript ES6+
- Sistema de combate ECS
- Sistema de combos

### Archivos/Componentes Principales
- `frontend/src/config/combat-actions-config.js` - Renombrar `lightAttack` → `attack`
- `frontend/src/config/combat-constants.js` - Renombrar `LIGHT_ATTACK` → `ATTACK`, eliminar `INPUT_ACTION_NAMES`
- `frontend/src/config/weapon-animations-config.js` - Renombrar keys `lightAttack` → `attack`
- `frontend/src/ecs/systems/combo-system.js` - Usar `ACTION_IDS.ATTACK`
- `frontend/src/ecs/systems/combat-system.js` - Usar `ACTION_IDS.ATTACK`

## Criterios de Aceptación

1. [ ] `COMBAT_ACTIONS.lightAttack` renombrado a `COMBAT_ACTIONS.attack`
2. [ ] `COMBAT_ACTIONS.attack.id` = `'attack'` (antes era `'lightAttack'`)
3. [ ] `COMBAT_CONSTANTS.ACTION_IDS.LIGHT_ATTACK` renombrado a `ATTACK`
4. [ ] `INPUT_ACTION_NAMES` eliminado (duplicación innecesaria)
5. [ ] `combo-system.js` usa `COMBAT_CONSTANTS.ACTION_IDS.ATTACK` en lugar de `LIGHT_ATTACK`
6. [ ] `weapon-animations-config.js` actualizado: key `lightAttack` → `attack`
7. [ ] Todos los usos de `'lightAttack'` reemplazados por `'attack'`
8. [ ] Los combos funcionan correctamente (BUG CORREGIDO)
9. [ ] El ataque básico funciona igual que antes
10. [ ] No hay referencias hardcodeadas a `'lightAttack'` restantes

## Detalles de Implementación

### Consideraciones Técnicas

- **Compatibilidad**: Los valores son semánticamente equivalentes (`'lightAttack'` vs `'attack'`)
- **Riesgo**: Bajo - cambios son puramente de renombrado de strings, no afectan lógica funcional
- **Performance**: Cero impacto de performance - solo cambios de nombres de strings

### Dependencias
- Depende de: Ninguna
- Bloquea: Ninguna

## Testing

### Escenarios de Prueba
1. **Escenario 1 - Ataque básico**: Verificar que el ataque básico funciona (click izquierdo)
2. **Escenario 2 - Combos**: Verificar que los combos se activan correctamente (BUG CORREGIDO)
3. **Escenario 3 - Animaciones**: Verificar que las animaciones de ataque funcionan
4. **Escenario 4 - Sin referencias**: Verificar que no quedan referencias a `lightAttack` o `INPUT_ACTION_NAMES` en código
5. **Escenario 5 - Linter**: Verificar que no hay errores de lint en archivos modificados

### Casos Edge a Considerar
- **Referencias externas**: Si hay código externo que use `'lightAttack'`, requiere actualización
- **Cache de build**: Cache de build podría tener referencias antiguas

## Estimación

- **Complejidad:** Baja
- **Tiempo estimado:** 1-2 horas
- **Notas:** Cambios son puramente de renombrado de strings, no afectan lógica funcional

## Referencias

- **Relacionado con:** JDG-029 (centralización de constantes)
- **Documentación relevante:** `frontend/src/ecs/animation/README.md`
- **Análisis relacionado:** `JDG-029-review-attack-lightattack_2025-12-13_19-30-00.md`
- **Plan de acción:** `JDG-029-2-action-plan_2025-12-13_19-39-52.md`

## Notas Adicionales

- **Bug Corregido**: Este cambio corrige el bug donde los combos no se activaban porque `combo-system.js` pasaba `'lightAttack'` pero los combos esperaban `'attack'`. Ahora ambos usan `'attack'` consistentemente.
- **Simplificación**: Se eliminó la duplicación innecesaria de `INPUT_ACTION_NAMES` que era idéntico a `ACTION_IDS` excepto por la diferencia `ATTACK` vs `LIGHT_ATTACK`. Ahora todo usa `ACTION_IDS` consistentemente.
- **Plan de Rollback**: Si hay algún problema, se puede revertir fácilmente el commit ya que los valores son semánticamente equivalentes.
