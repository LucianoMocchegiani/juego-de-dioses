# JDG-030 - Sistema de Debugging y Herramientas de Desarrollo

## Tipo
- [x] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [ ] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [ ] Alta (bloquea funcionalidad crítica)
- [x] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

El juego carecía de herramientas de debugging estructuradas, dificultando la identificación de problemas, inspección de estado en runtime, y monitoreo de performance. Se necesitaba un sistema completo que permitiera debugging eficiente sin afectar el rendimiento en producción.

### Comportamiento Actual

- No hay sistema de logging estructurado
- No hay herramientas para inspeccionar estado ECS en runtime
- No hay métricas detalladas de performance por sistema
- No hay validación de estado para detectar problemas
- No hay herramientas visuales de debugging
- Difícil identificar problemas y monitorear performance

### Comportamiento Esperado

- Sistema de logging estructurado con niveles (debug, info, warn, error)
- Inspector de estado ECS para inspeccionar entidades y componentes
- Métricas detalladas de performance por sistema (frame time, entidades procesadas)
- Validación de estado que detecta estados inválidos y muestra warnings
- Sistema de eventos estructurado para debugging y timeline
- Panel de debugging visual (F3) con métricas y logs en tiempo real
- Interfaz GUI de debugging (F4) con tabs organizados
- Todas las herramientas son opcionales y no afectan performance cuando están deshabilitadas

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura
- [ ] API Endpoints
- [ ] WebSockets

### Tecnologías Involucradas
- JavaScript ES6+
- Three.js
- ECS (Entity Component System)
- HTML5 Canvas
- CSS3

### Archivos/Componentes Principales
- `frontend/src/debug/config.js` - Configuración centralizada
- `frontend/src/debug/logger.js` - Sistema de logging estructurado
- `frontend/src/debug/inspector.js` - Inspector de estado ECS
- `frontend/src/debug/metrics.js` - Sistema de métricas de performance
- `frontend/src/debug/validator.js` - Validador de estado
- `frontend/src/debug/events.js` - Sistema de eventos estructurado
- `frontend/src/debug/ui/debug-panel.js` - Panel visual (F3)
- `frontend/src/debug/ui/debug-interface.js` - Interfaz GUI (F4)
- `frontend/src/app.js` - Integración del sistema
- `frontend/src/ecs/manager.js` - Métodos para debugging

## Criterios de Aceptación

1. [ ] Sistema de logging estructurado funcionando con niveles (debug, info, warn, error)
2. [ ] Validación de estado detecta estados inválidos y muestra warnings
3. [ ] Inspector de estado puede inspeccionar entidades y componentes
4. [ ] Métricas detalladas muestran frame time por sistema
5. [ ] Sistema de eventos emite y registra eventos para debugging
6. [ ] Panel de debugging UI muestra métricas y logs en tiempo real (F3)
7. [ ] Interfaz GUI de debugging con tabs organizados (F4)
8. [ ] Todas las herramientas son opcionales y no afectan performance cuando están deshabilitadas
9. [ ] Documentación completa en READMEs y guías de uso
10. [ ] Herramientas se deshabilitan automáticamente en producción

## Detalles de Implementación

### Consideraciones Técnicas

- **Modo desarrollo**: Detección automática basada en `window.location.hostname === 'localhost'` o `process.env.NODE_ENV === 'development'`
- **Performance**: Todas las herramientas se deshabilitan en producción por defecto
- **Exposición global**: Herramientas se exponen en `window.developmentTools` solo en desarrollo
- **Bloqueo de input**: Interfaz F4 bloquea automáticamente input del juego cuando está abierta
- **Transparencia**: Interfaz permite ver el juego detrás

### Dependencias
- Depende de: Ninguna
- Bloquea: Ninguna

## Testing

### Escenarios de Prueba
1. **Escenario 1 - Logging**: Verificar que logs se muestran correctamente con niveles apropiados
2. **Escenario 2 - Inspector**: Verificar que se pueden inspeccionar entidades y componentes
3. **Escenario 3 - Métricas**: Verificar que métricas muestran frame time por sistema
4. **Escenario 4 - Panel F3**: Verificar que panel F3 muestra métricas y logs en tiempo real
5. **Escenario 5 - Interfaz F4**: Verificar que interfaz F4 funciona con todos los tabs
6. **Escenario 6 - Producción**: Verificar que herramientas se deshabilitan en producción
7. **Escenario 7 - Filtrado**: Verificar filtrado de logs por entidad
8. **Escenario 8 - Bloqueo input**: Verificar que input se bloquea cuando F4 está abierta

### Casos Edge a Considerar
- **Performance en desarrollo**: Las herramientas no deben afectar significativamente el rendimiento
- **Múltiples entidades**: El inspector debe manejar correctamente muchas entidades
- **Eventos frecuentes**: El sistema de eventos no debe causar memory leaks

## Estimación

- **Complejidad:** Media-Alta
- **Tiempo estimado:** 8-12 horas
- **Notas:** Sistema completo con múltiples componentes y herramientas visuales

## Referencias

- **Relacionado con:** Ninguna
- **Documentación relevante:** `frontend/src/debug/README.md`, `frontend/src/debug/USO-INTERFAZ.md`, `frontend/src/debug/USO-CONSOLA.md`
- **Plan de acción:** `instructions/tasks/JDG-030-action-plan_2025-12-14_13-28-29.md`
- **Análisis de arquitectura:** `instructions/analysis/JDG-030-debugging-system-analysis_2025-12-14_13-17-08.md`

## Notas Adicionales

- El sistema detecta modo desarrollo basándose en `window.location.hostname === 'localhost'` además de `process.env.NODE_ENV` para mayor compatibilidad
- La interfaz F4 bloquea automáticamente el input del juego cuando está abierta para evitar interferencias
- Los logs se pueden filtrar por entidad ID en la interfaz F4 para debugging granular
- El panel F3 muestra las últimas 10 líneas de logs para monitoreo rápido sin abrir la interfaz completa
- Todas las herramientas son completamente opcionales y no afectan funcionalidad del juego si están deshabilitadas
