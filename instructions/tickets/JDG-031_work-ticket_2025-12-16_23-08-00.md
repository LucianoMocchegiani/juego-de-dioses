# JDG-031 - Interfaz de Prueba y Clasificación de Animaciones

## Tipo
- [x] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [ ] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [ ] Alta (bloquea funcionalidad crítica)
- [x] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

Se necesita una interfaz de desarrollo para probar y clasificar animaciones del juego. Actualmente, las animaciones están definidas en `ANIMATION_FILES` pero no hay una forma fácil de:
1. Listar todas las animaciones disponibles
2. Probar cada animación individualmente en el personaje
3. Clasificar animaciones por categoría (ataques, defensa, movimiento, etc.)
4. Ver información sobre cada animación (nombre, ruta, duración, etc.)

Esta herramienta es esencial para el desarrollo y testing del sistema de animaciones, permitiendo identificar rápidamente qué animaciones funcionan correctamente y cómo se ven en el juego.

### Comportamiento Actual

- Las animaciones están definidas en `frontend/src/config/animation-config.js` en `ANIMATION_FILES`
- Las animaciones se cargan desde `backend/static/models/animations/` usando `AnimationMixerSystem`
- No existe una interfaz visual para probar animaciones
- Para probar una animación, se necesita modificar código o usar la consola del navegador
- No hay forma de ver todas las animaciones disponibles de un vistazo
- No hay forma de clasificar o categorizar animaciones visualmente

### Comportamiento Esperado

**Interfaz de Prueba de Animaciones:**
- Interfaz similar al debugger (F4) pero específica para animaciones
- Se activa con F6 (F5 está reservada para recargar página en navegadores)
- Lista todas las animaciones disponibles desde `ANIMATION_FILES`
- Permite hacer click en cada animación para reproducirla en el personaje
- Muestra información de cada animación:
  - Nombre de la animación (key de `ANIMATION_FILES`)
  - Nombre del archivo GLB (valor de `ANIMATION_FILES`)
- Búsqueda opcional por nombre para facilitar encontrar animaciones en listas largas
- Reproducción directa de animaciones sin modificar código

**Reutilización de Código:**
- Refactorizar `DebugInterface` para extraer componentes reutilizables (tabs, paneles, estilos)
- Crear una clase base o utilidades compartidas para interfaces de desarrollo
- La nueva interfaz debe seguir el mismo patrón visual y de interacción que el debugger

**Integración:**
- La interfaz debe acceder al `AnimationMixerSystem` para reproducir animaciones
- Debe funcionar solo en modo desarrollo (localhost/127.0.0.1)
- Debe exponerse globalmente como `window.animationTester` o similar

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI) - No requiere cambios (las animaciones ya están disponibles en `/static/models/animations/`)
- [x] Frontend (Three.js) - Nueva interfaz y refactorización del debugger
- [ ] Base de Datos (PostgreSQL) - No afectado
- [ ] Cache (Redis) - No afectado
- [ ] Docker/Infraestructura - No afectado
- [ ] API Endpoints - No requiere nuevos endpoints
- [ ] WebSockets - No afectado

### Tecnologías Involucradas
- **JavaScript ES6+**: Lógica de la interfaz y reproducción de animaciones
- **DOM API**: Creación de elementos de interfaz
- **Three.js**: Acceso a `AnimationMixerSystem` para reproducir animaciones
- **CSS**: Estilos para la interfaz (similar al debugger)

### Archivos/Componentes Principales

**Frontend - Archivos nuevos:**
- `frontend/src/debug/ui/animation-tester.js` - Interfaz principal de prueba de animaciones
- `frontend/src/debug/ui/base-interface.js` - Clase base o utilidades compartidas para interfaces de desarrollo (refactorizado desde `DebugInterface`)

**Frontend - Archivos a modificar:**
- `frontend/src/debug/ui/debug-interface.js` - Refactorizar para usar `base-interface.js` o utilidades compartidas
- `frontend/src/ecs/systems/animation-mixer-system.js` - Agregar método público `playAnimationByName(entityId, animationName)` para reproducir animaciones directamente
- `frontend/src/debug/dev-exposure.js` - Exponer `animationTester` globalmente en modo desarrollo
- `frontend/src/app.js` - Inicializar `AnimationTester` junto con otras herramientas de debug

**Configuración:**
- `frontend/src/config/animation-config.js` - Ya contiene `ANIMATION_FILES` con todas las animaciones

## Criterios de Aceptación

1. [ ] Existe una interfaz visual para probar animaciones (similar al debugger)
2. [ ] La interfaz se activa con F6 (F5 está reservada para recargar página)
3. [ ] La interfaz lista todas las animaciones de `ANIMATION_FILES`
4. [ ] Cada animación en la lista tiene un botón "Reproducir" para probarla
5. [ ] Al hacer click en "Reproducir", la animación se reproduce en el personaje del jugador
6. [ ] La interfaz muestra información de cada animación:
    - Nombre de la animación (key de `ANIMATION_FILES`)
    - Nombre del archivo GLB (valor de `ANIMATION_FILES`)
7. [ ] La interfaz permite buscar animaciones por nombre (opcional, para facilitar encontrar animaciones)
8. [ ] La interfaz solo funciona en modo desarrollo (localhost/127.0.0.1)
9. [ ] El código del debugger ha sido refactorizado para reutilizar componentes comunes
10. [ ] `AnimationMixerSystem` tiene un método público para reproducir animaciones por nombre
11. [ ] La interfaz está expuesta globalmente como `window.animationTester` en modo desarrollo

## Detalles de Implementación

### Consideraciones Técnicas

**Refactorización del Debugger:**
- Extraer lógica común de creación de interfaz (header, tabs, estilos base)
- Crear clase base `BaseDebugInterface` o utilidades compartidas
- Mantener compatibilidad con `DebugInterface` existente
- Los estilos y estructura visual deben ser consistentes entre ambas interfaces

**Reproducción de Animaciones:**
- Agregar método `playAnimationByName(entityId, animationName)` en `AnimationMixerSystem`
- El método debe:
  - Buscar el clip de animación en `mesh.userData.animationClips`
  - Crear y reproducir la acción de animación
  - Manejar casos donde la animación no existe
  - Detener animación actual si es necesario
- El método debe ser público para uso desde la interfaz

**Estructura de la Interfaz:**
- Header con título "Animation Tester" y botón de cerrar
- Área principal con lista de animaciones
- Cada item de animación debe mostrar:
  - Nombre de la animación (key de `ANIMATION_FILES`)
  - Nombre del archivo GLB (valor de `ANIMATION_FILES`)
  - Botón "Reproducir" para probar la animación
- Campo de búsqueda opcional por nombre (para facilitar encontrar animaciones en listas largas)

**Nota sobre Clasificación:**
- La clasificación de animaciones se hará manualmente por el usuario fuera de la interfaz
- La interfaz solo muestra la información necesaria para identificar y probar animaciones

**Performance:**
- La lista de animaciones se genera una vez al abrir la interfaz
- No cargar animaciones hasta que se haga click en "Reproducir"
- Usar el cache existente de `AnimationMixerSystem` para animaciones ya cargadas

**Compatibilidad:**
- Funcionar solo en modo desarrollo
- No afectar el rendimiento del juego cuando está cerrada
- No interferir con el input del juego cuando está abierta (bloquear input del juego si es necesario)

### Dependencias

- **Depende de**: JDG-015 (Sistema de Animaciones - ya completado), JDG-025 (Sistema de Equipamiento de Armas - ya completado)
- **No bloquea**: Ningún otro ticket

## Testing

### Escenarios de Prueba

1. **Abrir Interfaz:**
   - Presionar F5 (o tecla asignada)
   - Verificar que la interfaz se muestra correctamente
   - Verificar que lista todas las animaciones de `ANIMATION_FILES`

2. **Reproducir Animación:**
   - Hacer click en una animación de la lista
   - Verificar que se reproduce en el personaje
   - Verificar que la animación anterior se detiene correctamente

3. **Buscar Animación:**
   - Buscar animación por nombre en el campo de búsqueda
   - Verificar que se filtran correctamente las animaciones

4. **Manejo de Errores:**
   - Intentar reproducir animación que no existe
   - Verificar que se muestra mensaje de error apropiado
   - Verificar que no se rompe el juego

5. **Modo Desarrollo:**
   - Verificar que la interfaz solo funciona en localhost/127.0.0.1
   - Verificar que no se expone en producción

### Casos Edge a Considerar

- Personaje no existe o no tiene mixer inicializado - mostrar mensaje apropiado
- Animación no existe en los clips cargados - manejar gracefully
- Múltiples clicks rápidos en diferentes animaciones - manejar correctamente
- Interfaz abierta mientras se reproduce animación del juego - no interferir

## Estimación

- **Complejidad:** Media
- **Tiempo estimado:** 1-2 días
- **Notas:** 
  - La refactorización del debugger puede tomar tiempo adicional
  - La interfaz es relativamente simple pero requiere integración con el sistema de animaciones
  - El método `playAnimationByName` debe ser cuidadoso para no romper la lógica existente

## Referencias

- **Relacionado con:** JDG-015 (Sistema de Animaciones), JDG-025 (Sistema de Equipamiento de Armas)
- **Documentación relevante:**
  - `frontend/src/config/animation-config.js` - Configuración de animaciones
  - `frontend/src/ecs/systems/animation-mixer-system.js` - Sistema de reproducción de animaciones
  - `frontend/src/debug/ui/debug-interface.js` - Interfaz de debugger (para reutilizar código)
- **Archivos de animaciones:** `backend/static/models/animations/`

## Notas Adicionales

**Animaciones Disponibles:**
Las animaciones están definidas en `ANIMATION_FILES` y se cargan desde `/static/models/animations/`. Incluyen:
- Ataques: `left_slash`, `attack`, `heavy_hammer_swing`, `axe_spin_attack`, etc.
- Defensa: `sword_parry_backward`, `shield_push_left`, `stand_dodge`, `roll_dodge`
- Movimiento: `walk`, `run`, `regular_jump`, `backflip`, `crouch_walk_forward`, etc.
- Reacciones: `hit_reaction`, `electrocution_reaction`, `falling_down`, etc.
- Especiales: `collect_object`, `stand_and_drink`, `charged_spell_cast`, etc.
- Idle/Stance: `combat_stance`, `idle_11`

**Reutilización de Código:**
El objetivo es refactorizar `DebugInterface` para extraer componentes comunes y crear una clase base o utilidades compartidas. Esto facilitará crear futuras interfaces de desarrollo siguiendo el mismo patrón.

**Nota sobre Clasificación:**
La clasificación de animaciones se realizará manualmente por el usuario fuera de la interfaz. La interfaz solo proporciona la información necesaria (nombre y archivo GLB) para identificar y probar animaciones.

**Futuro:**
- Agregar información de duración de animaciones
- Agregar preview de animaciones (miniaturas)
- Integración con sistema de combos para probar secuencias de animaciones
