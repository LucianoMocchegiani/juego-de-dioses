# JDG-032 - Migración de Estructura de Animaciones y Mejora de Interfaz de Debugger

## Tipo
- [x] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [ ] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [ ] Alta (bloquea funcionalidad crítica)
- [x] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

Actualmente, las animaciones están duplicadas: existen tanto en la raíz de `backend/static/models/animations/` como dentro de `biped/` organizadas por categorías (sword, axe, movement, idle, hit-reactions, etc.). Las mismas animaciones que están en la raíz ya están distribuidas y organizadas dentro de `biped/`, creando duplicación innecesaria.

Necesitamos:
1. Eliminar las copias duplicadas de la raíz, ya que las mismas animaciones ya están organizadas en `biped/`
2. Actualizar el sistema de rutas en el frontend para usar la estructura organizada en `biped/` en lugar de la raíz
3. Modificar la interfaz de debugger de animaciones (F6) para mostrar las animaciones organizadas por carpetas según la estructura que ya existe en `biped/`
4. Permitir que nuevas animaciones puedan dejarse temporalmente en la raíz para pruebas y luego organizarse fácilmente en sus carpetas correspondientes dentro de `biped/`

### Comportamiento Actual

- **Estructura de archivos**: Las animaciones están duplicadas - existen tanto en la raíz de `backend/static/models/animations/` como organizadas dentro de `biped/` en carpetas por categorías
- **Configuración**: `ANIMATION_FILES` en `frontend/src/config/animation-config.js` usa rutas que apuntan a la raíz (copias duplicadas) como `'animations/Animation_XXX_withSkin.glb'`, en lugar de las versiones organizadas en `biped/`
- **Interfaz de debugger**: El AnimationTester (F6) muestra una lista plana de todas las animaciones sin reflejar la organización por carpetas que ya existe en el sistema de archivos
- **Sistema de carga**: `AnimationMixerSystem` carga animaciones desde las rutas configuradas (actualmente apuntan a la raíz)

### Comportamiento Esperado

- **Estructura de archivos**: Todas las animaciones organizadas dentro de `biped/` por categorías:
  - `biped/sword/` - Animaciones de espada
  - `biped/axe/` - Animaciones de hacha
  - `biped/movement/` - Movimientos básicos
  - `biped/idle/` - Animaciones idle
  - `biped/hit-reactions/` - Reacciones a daño
  - `biped/interactions/` - Interacciones con objetos
  - etc.
- **Configuración**: `ANIMATION_FILES` actualizado con rutas que incluyen las carpetas, ej: `'animations/biped/sword/Animation_Left_Slash_withSkin.glb'`
- **Interfaz de debugger**: Muestra animaciones agrupadas por carpetas con una vista jerárquica (árbol de carpetas)
- **Sistema de carga**: Debe seguir funcionando con las nuevas rutas
- **Workflow futuro**: Se pueden dejar animaciones nuevas en la raíz para pruebas, y aparecerán en una sección especial "Sin categorizar" en el debugger

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura
- [ ] API Endpoints
- [ ] WebSockets

### Tecnologías Involucradas
- JavaScript ES6+
- Three.js (GLTFLoader, AnimationMixer)
- FastAPI (servidor estático)
- Sistema de archivos del servidor

### Archivos/Componentes Principales
- `backend/static/models/animations/` - Estructura de archivos (a migrar)
- `frontend/src/config/animation-config.js` - Configuración de rutas de animaciones (a actualizar)
- `frontend/src/debug/ui/animation-tester.js` - Interfaz de debugger (a mejorar)
- `frontend/src/ecs/systems/animation-mixer-system.js` - Sistema de carga de animaciones (verificar compatibilidad)

### Estructura Actual de Carpetas (biped/)
- `axe/` - 1 archivo
- `cuffs/` - 1 archivo
- `hammer/` - 1 archivo
- `hit-reactions/` - 7 archivos
- `idle/` - 3 archivos
- `interactions/` - 4 archivos
- `movement/` - 7 archivos
- `secondary-interactions/` - 4 archivos
- `shield/` - 1 archivo
- `skills/` - 3 archivos
- `spear/` - 1 archivo
- `sword/` - 4 archivos
- `two-hand-axe/` - 1 archivo
- `two-hand-hammer/` - 1 archivo
- `two-hand-sword/` - 1 archivo
- `two-swords/` - 1 archivo

Total: ~42 archivos ya organizados en la nueva estructura

### Estructura Antigua (raíz de animations/)
- ~43 archivos `Animation_XXX_withSkin.glb` directamente en la raíz

## Criterios de Aceptación

1. [ ] Todas las animaciones duplicadas de la raíz han sido eliminadas, dejando solo las versiones organizadas en `biped/`
2. [ ] El archivo `animation-config.js` ha sido actualizado con las nuevas rutas (ej: `'animations/biped/sword/Animation_XXX_withSkin.glb'`)
3. [ ] El sistema de carga de animaciones (`AnimationMixerSystem`) funciona correctamente con las nuevas rutas
4. [ ] La interfaz de debugger (F6) muestra las animaciones agrupadas por carpetas con una vista jerárquica
5. [ ] Las animaciones sin categorizar (si quedan en la raíz) aparecen en una sección "Sin categorizar" en el debugger
6. [ ] No hay errores de carga de animaciones en el juego
7. [ ] Todas las animaciones existentes siguen funcionando correctamente después de la migración

## Detalles de Implementación

### Consideraciones Técnicas

- **Compatibilidad**: Asegurar que las animaciones existentes sigan funcionando después de la migración
- **Performance**: La carga de animaciones no debe verse afectada negativamente
- **Mantenibilidad**: La nueva estructura debe facilitar la organización y búsqueda de animaciones
- **Extensibilidad**: Debe ser fácil agregar nuevas categorías de animaciones en el futuro

### Verificación de Duplicados

Necesitamos verificar que cada animación de la raíz tiene su equivalente en `biped/` antes de eliminar:

**Ejemplos de equivalencias:**
- `Animation_Left_Slash_withSkin.glb` (raíz) ↔ `biped/sword/Animation_Left_Slash_withSkin.glb` (organizada)
- `Animation_Attack_withSkin.glb` (raíz) ↔ `biped/two-hand-sword/Animation_Attack_withSkin.glb` (organizada)
- `Animation_Walking_withSkin.glb` (raíz) ↔ `biped/movement/Animation_Walking_withSkin.glb` (organizada)
- `Animation_Hit_Reaction_withSkin.glb` (raíz) ↔ `biped/hit-reactions/Animation_Hit_Reaction_withSkin.glb` (organizada)
- `Animation_Idle_11_withSkin.glb` (raíz) ↔ `biped/idle/Animation_Idle_11_withSkin.glb` (organizada)

**Nota**: Las animaciones ya están organizadas en `biped/`, solo necesitamos eliminar las copias de la raíz y actualizar las rutas.

### Cambios en Frontend

1. **animation-config.js**: Actualizar todas las rutas en `ANIMATION_FILES` para incluir la ruta de carpeta
2. **animation-tester.js**: 
   - Modificar la visualización para mostrar animaciones agrupadas por carpetas
   - Implementar vista de árbol jerárquico (carpetas expandibles/colapsables)
   - Agregar sección "Sin categorizar" para animaciones en la raíz
   - Mantener funcionalidad de búsqueda pero mejorada para buscar por carpeta

### Estrategia de Migración

1. Verificar que todas las animaciones de la raíz tienen su equivalente en `biped/` (las mismas animaciones ya están organizadas)
2. Eliminar las copias duplicadas de la raíz (manteniendo solo las versiones organizadas en `biped/`)
3. Actualizar `animation-config.js` para que las rutas apunten a las versiones organizadas en `biped/`
4. Actualizar `animation-tester.js` para mostrar la estructura jerárquica que ya existe en `biped/`
5. Probar que todas las animaciones se cargan correctamente desde las nuevas rutas
6. Verificar que no hay rutas rotas

### Dependencias

- No depende de otros tickets
- No bloquea otros tickets (puede hacerse en paralelo)

## Testing

### Escenarios de Prueba

1. **Carga de animaciones**: Verificar que todas las animaciones se cargan correctamente después de la migración
2. **Interfaz de debugger**: 
   - Abrir F6 y verificar que las animaciones aparecen agrupadas por carpetas
   - Expandir/colapsar carpetas
   - Buscar animaciones por nombre
   - Buscar animaciones por carpeta
   - Reproducir animaciones desde diferentes carpetas
3. **Animaciones en juego**: Verificar que las animaciones funcionan correctamente durante gameplay
4. **Animaciones sin categorizar**: Si hay animaciones en la raíz, verificar que aparecen en sección "Sin categorizar"

### Casos Edge a Considerar

- Animaciones duplicadas (mismo nombre en diferentes carpetas)
- Animaciones con nombres que no coinciden exactamente con el mapeo esperado
- Rutas incorrectas después de la migración
- Caché del navegador que pueda mantener rutas antiguas

## Estimación

- **Complejidad:** Media
- **Tiempo estimado:** 4-6 horas
- **Notas:** 
  - Migración de archivos: ~30 minutos
  - Actualización de configuración: ~1 hora
  - Actualización de interfaz de debugger: ~2-3 horas
  - Testing: ~1 hora

## Referencias

- **Estructura nueva**: `backend/static/models/animations/biped/`
- **Interfaz de debugger**: `frontend/src/debug/ui/animation-tester.js`
- **Configuración**: `frontend/src/config/animation-config.js`
- **Sistema de animaciones**: `frontend/src/ecs/systems/animation-mixer-system.js`

## Notas Adicionales

- **IMPORTANTE**: Las animaciones ya están organizadas en `biped/` - las mismas animaciones que están en la raíz ya están distribuidas dentro de `biped/` en sus carpetas correspondientes
- El objetivo principal es eliminar las copias duplicadas de la raíz y actualizar las rutas para usar las versiones organizadas
- La interfaz de debugger mejorada reflejará la estructura organizacional que ya existe en el sistema de archivos
- Para nuevas animaciones: se pueden dejar temporalmente en la raíz para pruebas y luego moverlas a sus carpetas correspondientes en `biped/`
- Considerar crear una herramienta o script para ayudar en la organización automática de nuevas animaciones en el futuro
