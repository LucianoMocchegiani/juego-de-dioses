# JDG-035 - Reorganización Arquitectónica del Frontend

## Tipo
- [ ] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [x] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [ ] Alta (bloquea funcionalidad crítica)
- [x] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

El código del frontend tenía problemas de organización que dificultaban el mantenimiento y la escalabilidad:
- Código de terreno disperso en múltiples módulos sin cohesión
- Infraestructura base mezclada con código específico de dominio
- Modelos 3D ubicados incorrectamente (en renderers aunque solo se usan por ECS)
- Servicios de integración sin una ubicación clara
- Módulos vacíos sin propósito claro

Esta refactorización resuelve estos problemas organizando el código según su propósito y dependencias, siguiendo principios de separación de responsabilidades y organización por dominio.

### Comportamiento Actual

- Código de terreno disperso en `managers/`, `renderers/`, `utils/` sin cohesión
- Infraestructura base mezclada con código específico de dominio
- Modelos 3D en `renderers/models/` aunque solo se usan por ECS
- Servicios de integración (`camera-controller`, `collision-detector`) sin ubicación clara
- Módulos vacíos (`renderers/`, `managers/`, `systems/`, `components/`) sin propósito

### Comportamiento Esperado

- Sistema de terreno consolidado en módulo autocontenido `terrain/`
- Infraestructura base movida a `core/` (geometries, renderers, performance, input)
- Modelos 3D movidos a `ecs/models/`
- Servicios de integración movidos a `world/`
- Módulos vacíos eliminados
- Todos los imports actualizados correctamente
- Estructura clara y mantenible

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura
- [ ] API Endpoints
- [ ] WebSockets

### Tecnologías Involucradas
- JavaScript ES6+
- Three.js
- ECS (Entity Component System)

### Archivos/Componentes Principales

**Fase 1 - Sistema de Terreno:**
- `ViewportManager` → `terrain/components/viewport.js` + `terrain/systems/viewport-system.js`
- `StyleManager` → `terrain/components/style.js` + `terrain/systems/style-system.js`
- `GeometryCache` → `terrain/components/geometry.js`
- `ParticleRenderer` → `terrain/renderers/particle-renderer.js`
- `LODManager`, `ParticleLimiter` → `terrain/optimizations/`
- `culling.js`, `sorting.js` → `terrain/utils/`
- API clients → `terrain/api/`
- `TerrainManager` como punto de entrada único

**Fase 2 - Módulos Restantes:**
- Infraestructura base → `core/`:
  - `renderers/geometries/registry.js` → `core/geometries/registry.js`
  - `renderers/base-renderer.js` → `core/renderers/base-renderer.js`
  - `managers/performance-manager.js` → `core/performance/performance-manager.js`
  - `systems/input-manager.js` → `core/input/input-manager.js`
- Modelos 3D → `ecs/models/`:
  - `renderers/models/` completo → `ecs/models/`
- Servicios de integración → `world/`:
  - `systems/camera-controller.js` → `world/camera-controller.js`
  - `systems/collision-detector.js` → `world/collision-detector.js`
- Eliminados módulos vacíos: `renderers/`, `managers/`, `systems/`, `components/`

## Criterios de Aceptación

1. [ ] Sistema de terreno consolidado en módulo autocontenido
2. [ ] Infraestructura base movida a `core/`
3. [ ] Modelos 3D movidos a `ecs/models/`
4. [ ] Servicios de integración movidos a `world/`
5. [ ] Todos los imports actualizados correctamente
6. [ ] Módulos vacíos eliminados
7. [ ] Sin errores de linter
8. [ ] Documentación actualizada
9. [ ] Compatibilidad de API mantenida (TerrainManager, Store, actions, selectors sin cambios)
10. [ ] Estructura verificada y funcional

## Detalles de Implementación

### Consideraciones Técnicas

- **Breaking changes**: Módulos `renderers/`, `managers/`, `systems/`, `components/` eliminados
- **Compatibilidad**: API pública mantenida (TerrainManager, Store, etc.)
- **Imports**: Todos los imports deben actualizarse sistemáticamente
- **Cache**: Cache de build podría tener referencias antiguas

### Estructura Final Resultante
```
src/
├── core/          # Infraestructura base compartida (geometries, renderers, performance, input)
├── ecs/           # Sistema ECS (con models/ para carga de modelos 3D)
├── terrain/       # Sistema de terreno autocontenido
├── world/         # Servicios de integración (camera-controller, collision-detector)
├── state/         # Estado global (mantenido en raíz)
└── utils/         # Utilidades generales (mantenido en raíz)
```

### Dependencias
- Depende de: Ninguna
- Bloquea: Ninguna

## Testing

### Escenarios de Prueba
1. **Escenario 1 - Imports**: Verificar que todos los imports funcionan correctamente
2. **Escenario 2 - Terreno**: Verificar que terreno se renderiza correctamente
3. **Escenario 3 - Personajes**: Verificar que personajes se cargan correctamente
4. **Escenario 4 - Cámara**: Verificar que cámara sigue al jugador
5. **Escenario 5 - Linter**: Verificar que no hay errores de linter
6. **Escenario 6 - Estructura**: Verificar estructura de directorios
7. **Escenario 7 - API**: Verificar que API pública funciona igual que antes

### Casos Edge a Considerar
- **Imports rotos**: Posibles imports rotos si hay código externo que importa módulos eliminados
- **Cache de build**: Cache de build podría tener referencias antiguas
- **Referencias externas**: Si hay código externo que importa módulos eliminados, requiere actualización

## Estimación

- **Complejidad:** Media-Alta
- **Tiempo estimado:** 6-8 horas
- **Notas:** Refactorización estructural que requiere actualizar todos los imports sistemáticamente

## Referencias

- **Relacionado con:** Ninguna
- **Documentación relevante:** READMEs actualizados
- **Análisis JDG-035-2:** `instructions/analysis/JDG-035-2-architecture-analysis_*.md`
- **Análisis JDG-035-3:** `instructions/analysis/JDG-035-3-architecture-analysis_*.md`
- **Análisis JDG-035-4:** `instructions/analysis/JDG-035-4-architecture-analysis_*.md`

## Notas Adicionales

- Esta es una refactorización puramente estructural sin cambios visuales
- Se recomienda ejecutar tests completos para verificar que nada se rompió
- Si hay código externo que importa módulos eliminados, requiere actualización
- Plan de rollback: Revertir commits y verificar que código vuelve a estado anterior
- Si hay problemas con cache, hacer rebuild completo de imágenes Docker
