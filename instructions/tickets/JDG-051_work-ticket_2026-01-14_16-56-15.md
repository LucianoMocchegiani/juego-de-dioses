# JDG-051 - Animaciones Direccionales de Caminar (Adelante, Atrás, Izquierda, Derecha)

## Tipo
- [x] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [ ] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [ ] Alta (bloquea funcionalidad crítica)
- [x] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

Actualmente, todas las direcciones de movimiento (WASD) utilizan la misma animación de caminar hacia adelante (`walk`). Esto causa que el personaje siempre muestre la animación de caminar hacia adelante independientemente de la dirección en la que se mueve, lo cual es visualmente incorrecto y reduce la inmersión del juego.

### Comportamiento Actual

- Todas las teclas de movimiento (W, A, S, D) activan el mismo estado de animación `walk`
- El estado `walk` siempre reproduce la animación `walk` (caminar hacia adelante)
- No hay diferenciación visual entre caminar hacia adelante, atrás, izquierda o derecha
- El sistema de animaciones no considera la dirección del movimiento al seleccionar la animación

### Comportamiento Esperado

- **Caminar hacia adelante (W)**: Debe usar animación `walk` o `walk_forward`
- **Caminar hacia atrás (S)**: Debe usar animación `walk_backward` o similar
- **Caminar hacia la derecha (D)**: Debe usar animación `walk_right` o similar
- **Caminar hacia la izquierda (A)**: Debe usar animación `walk_left` o similar
- Si las animaciones direccionales no están disponibles, el sistema debe usar la animación disponible más cercana o mantener la lógica actual como fallback
- El sistema debe determinar la dirección basándose en `input.moveDirection` relativo a la rotación del personaje

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura
- [ ] API Endpoints
- [ ] WebSockets

### Tecnologías Involucradas
- JavaScript ES6+
- Three.js AnimationMixer
- ECS (Entity Component System)
- Sistema de estados de animación declarativo

### Archivos/Componentes Principales
- `frontend/src/config/animation-config.js` - Agregar estados de animación direccionales
- `frontend/src/ecs/systems/animation-state-system.js` - Lógica para determinar dirección
- `frontend/src/ecs/conditions/movement-condition.js` - Condiciones de movimiento direccional
- `frontend/src/ecs/systems/animation-mixer-system.js` - Cargar y reproducir animaciones direccionales
- `frontend/src/config/animation-config.js` - Mapeo de animaciones direccionales en `ANIMATION_FILES`

## Criterios de Aceptación

1. [ ] El sistema detecta correctamente la dirección del movimiento (adelante, atrás, izquierda, derecha) basándose en `input.moveDirection` y la rotación del personaje
2. [ ] Cuando el jugador presiona W (adelante), se reproduce la animación de caminar hacia adelante
3. [ ] Cuando el jugador presiona S (atrás), se reproduce la animación de caminar hacia atrás (o la más cercana disponible)
4. [ ] Cuando el jugador presiona D (derecha), se reproduce la animación de caminar hacia la derecha (o la más cercana disponible)
5. [ ] Cuando el jugador presiona A (izquierda), se reproduce la animación de caminar hacia la izquierda (o la más cercana disponible)
6. [ ] Si las animaciones direccionales no están disponibles, el sistema usa un fallback apropiado (animación genérica de caminar)
7. [ ] La lógica funciona correctamente con diferentes rotaciones de cámara/personaje
8. [ ] No hay regresiones en otras animaciones existentes

## Detalles de Implementación

### Consideraciones Técnicas

- **Dirección relativa**: La dirección debe calcularse relativa a la rotación del personaje/cámara, no en coordenadas absolutas del mundo
- **Fallback**: Si las animaciones direccionales no existen, usar `walk` como fallback para mantener funcionalidad
- **Transiciones**: Las transiciones entre animaciones direccionales deben ser suaves
- **Performance**: El cálculo de dirección no debe impactar significativamente el rendimiento

### Dependencias
- Depende de: Ninguna
- Bloquea: JDG-052 (animaciones direccionales de agacharse)

## Testing

### Escenarios de Prueba
1. **Escenario 1 - Caminar hacia adelante**: Presionar W y verificar que se reproduce animación de caminar hacia adelante
2. **Escenario 2 - Caminar hacia atrás**: Presionar S y verificar que se reproduce animación de caminar hacia atrás (o fallback)
3. **Escenario 3 - Caminar lateral**: Presionar A o D y verificar que se reproduce animación lateral correspondiente (o fallback)
4. **Escenario 4 - Movimiento diagonal**: Presionar W+D y verificar que se usa la animación más apropiada (probablemente adelante o derecha)
5. **Escenario 5 - Rotación de cámara**: Rotar la cámara y verificar que las direcciones se mantienen correctas relativas al personaje
6. **Escenario 6 - Fallback**: Si las animaciones direccionales no existen, verificar que se usa `walk` como fallback

### Casos Edge a Considerar
- **Movimiento diagonal**: ¿Qué animación usar cuando se mueve en diagonal? (W+D, W+A, S+D, S+A)
- **Cambio rápido de dirección**: Las transiciones deben ser suaves al cambiar rápidamente entre direcciones
- **Animaciones faltantes**: Si no existen todas las animaciones direccionales, el sistema debe funcionar con las disponibles

## Estimación

- **Complejidad:** Media
- **Tiempo estimado:** 4-6 horas
- **Notas:** Depende de si las animaciones direccionales ya existen en los archivos GLB. Si no existen, puede requerir más tiempo para implementar fallbacks apropiados.

## Referencias

- **Relacionado con:** JDG-052 (animaciones direccionales de agacharse), JDG-053 (animaciones direccionales de nadar)
- **Documentación relevante:** `frontend/src/config/animation-config.js`, `frontend/src/ecs/systems/animation-state-system.js`
- **Discusiones previas:** Sistema de animaciones implementado en JDG-015, JDG-016, JDG-021

## Notas Adicionales

- Si las animaciones direccionales (`walk_backward`, `walk_right`, `walk_left`) no están disponibles en los archivos GLB, se debe implementar una lógica de fallback que use la animación `walk` existente pero con posible rotación/espejado del modelo para simular la dirección
- El cálculo de dirección debe considerar la rotación del personaje (`render.rotationY`) para determinar correctamente adelante/atrás/izquierda/derecha
- Se debe verificar qué animaciones están disponibles en `ANIMATION_FILES` antes de implementar
