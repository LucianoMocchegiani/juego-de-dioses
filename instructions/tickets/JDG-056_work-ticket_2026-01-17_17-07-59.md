# JDG-056 - Animaciones Direccionales de Nadar

## Tipo
- [x] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [ ] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [ ] Chore (tareas de mantenimiento)

## Prioridad
- [ ] Alta (bloquea funcionalidad crítica)
- [x] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento

Actualmente, todas las direcciones de natación (WASD) utilizan la misma animación (`swim_forward`), sin diferenciación entre nadar hacia adelante, atrás, izquierda o derecha. Esto es visualmente incorrecto y reduce la inmersión del jugador.

### Comportamiento Actual

- **Natación**: Todas las direcciones de natación (WASD) usan la misma animación `swim_forward`
- El estado `swim` siempre reproduce `swim_forward` sin importar la dirección del movimiento
- No hay diferenciación visual entre nadar hacia adelante, atrás, izquierda o derecha
- El sistema de animaciones no verifica la dirección del movimiento (W, A, S, D) al seleccionar la animación

### Comportamiento Esperado

- **Nadar hacia adelante (W)**: Debe usar animación `swim_forward`
- **Nadar hacia atrás (S)**: Debe usar animación `swim_backward` o similar (si existe)
- **Nadar hacia la derecha (D)**: Debe usar animación `swim_right` o similar (si existe)
- **Nadar hacia la izquierda (A)**: Debe usar animación `swim_left` o similar (si existe)
- El sistema debe verificar directamente las teclas presionadas (similar a JDG-051 y JDG-052) para seleccionar la animación correspondiente
- Solo se usa una dirección a la vez (prioridad: W > S > A > D), sin combinar teclas para movimiento diagonal
- Si las animaciones direccionales de nadar no están disponibles, el sistema debe usar `swim_forward` como fallback

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura
- [ ] API Endpoints
- [ ] WebSockets

### Tecnologías Involucradas
- JavaScript ES6+
- Three.js AnimationMixer
- ECS (Entity Component System)
- Sistema de estados de animación declarativo

### Archivos/Componentes Principales
- `frontend/src/config/animation-config.js` - Agregar animaciones direccionales de nadar a `ANIMATION_FILES` (si existen)
- `frontend/src/ecs/systems/animation-mixer-system.js` - Extender `getAnimationNameForState()` para soportar animaciones direccionales de `swim`
- `frontend/src/ecs/systems/animation-mixer-system.js` - Modificar `resolveAnimationName()` para pasar `InputComponent` cuando el estado es `swim`
- `frontend/src/ecs/systems/animation-mixer-system.js` - Modificar `playAnimation()` para detectar cambios en animaciones direccionales de `swim`

## Criterios de Aceptación

1. [ ] Cuando el jugador presiona W mientras nada, se reproduce animación `swim_forward`
2. [ ] Cuando el jugador presiona S mientras nada, se reproduce animación de nadar hacia atrás (o `swim_forward` como fallback si no existe)
3. [ ] Cuando el jugador presiona D mientras nada, se reproduce animación de nadar hacia la derecha (o `swim_forward` como fallback si no existe)
4. [ ] Cuando el jugador presiona A mientras nada, se reproduce animación de nadar hacia la izquierda (o `swim_forward` como fallback si no existe)
5. [ ] El sistema verifica directamente las teclas presionadas (KeyW, KeyS, KeyA, KeyD) similar a JDG-051 y JDG-052
6. [ ] Solo se usa una dirección a la vez (prioridad: W > S > A > D), sin combinar teclas para movimiento diagonal
7. [ ] Si las animaciones direccionales de nadar no están disponibles, el sistema usa `swim_forward` como fallback
8. [ ] Las animaciones direccionales aparecen en la interfaz F6 para testing
9. [ ] No hay regresiones en otras animaciones existentes

## Detalles de Implementación

### Consideraciones Técnicas

- **Estrategia simple**: Reutilizar la misma estrategia simple de JDG-051 y JDG-052: verificar directamente las teclas presionadas (KeyW, KeyS, KeyA, KeyD)
- **Prioridad de selección**: W (adelante) > S (atrás) > A (izquierda) > D (derecha) - solo una dirección a la vez
- **Fallback robusto**: Si las animaciones direccionales no existen, usar `swim_forward` como fallback para mantener funcionalidad
- **Verificación de animaciones**: Antes de implementar, verificar qué animaciones de nadar están disponibles en `backend/static/models/biped/male/animations/movement/`
- **Transiciones suaves**: Las transiciones entre direcciones de natación deben ser suaves al cambiar rápidamente entre direcciones

### Dependencias
- Depende de: JDG-051 (animaciones direccionales de caminar) y JDG-052 (animaciones direccionales de agacharse) - para reutilizar lógica de detección de dirección
- Bloquea: Ninguna

## Testing

### Escenarios de Prueba
1. **Escenario 1 - Nadar hacia adelante**: Presionar W mientras nada y verificar que se reproduce `swim_forward`
2. **Escenario 2 - Nadar hacia atrás**: Presionar S mientras nada y verificar que se reproduce animación de nadar hacia atrás (o fallback)
3. **Escenario 3 - Nadar hacia la derecha**: Presionar D mientras nada y verificar que se reproduce animación de nadar hacia la derecha (o fallback)
4. **Escenario 4 - Nadar hacia la izquierda**: Presionar A mientras nada y verificar que se reproduce animación de nadar hacia la izquierda (o fallback)
5. **Escenario 5 - Movimiento diagonal nadando**: Presionar W+D mientras nada y verificar que solo se usa W (prioridad)
6. **Escenario 6 - Cambio rápido de dirección**: Cambiar rápidamente entre direcciones mientras nada y verificar transiciones suaves
7. **Escenario 7 - Fallback**: Si las animaciones direccionales no existen, verificar que se usa `swim_forward` como fallback
8. **Escenario 8 - Interfaz F6**: Verificar que las animaciones direccionales aparecen en la interfaz F6 para testing

### Casos Edge a Considerar
- **Movimiento diagonal nadando**: Solo usar la primera tecla según prioridad (W > S > A > D)
- **Cambio rápido de dirección nadando**: Las transiciones deben ser suaves al cambiar rápidamente entre direcciones
- **Animaciones faltantes**: Si no existen todas las animaciones direccionales de nadar, el sistema debe funcionar con las disponibles
- **Sin input**: Si `InputComponent` no está disponible, usar fallback del estado config

## Estimación

- **Complejidad:** Media
- **Tiempo estimado:** 2-3 horas
- **Notas:** Similar a JDG-051 y JDG-052, reutiliza la misma estrategia simple. El tiempo depende de si las animaciones direccionales de nadar están disponibles o no.

## Referencias

- **Relacionado con:** JDG-051 (animaciones direccionales de caminar), JDG-052 (animaciones direccionales de agacharse)
- **Documentación relevante:** 
  - `frontend/src/config/animation-config.js`
  - `frontend/src/ecs/systems/animation-mixer-system.js`
  - `frontend/src/ecs/systems/animation-state-system.js`
- **PRs relacionados:** JDG-051, JDG-052

## Notas Adicionales

- Se debe verificar qué animaciones de nadar están disponibles en `ANIMATION_FILES` y en `backend/static/models/biped/male/animations/movement/` antes de implementar
- Si las animaciones direccionales de nadar no están disponibles, se puede considerar usar `swim_forward` como fallback (ya implementado)
- El sistema debe funcionar correctamente incluso si solo algunas animaciones direccionales están disponibles
- Reutilizar la misma estrategia simple de JDG-051 y JDG-052: verificar teclas directamente (KeyW, KeyS, KeyA, KeyD) en lugar de cálculos complejos
