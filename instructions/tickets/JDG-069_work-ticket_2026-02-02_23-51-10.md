# JDG-069 - Revisión a fondo post-refactor: verificar que no se rompió nada

## Tipo
- [ ] Feature (nueva funcionalidad)
- [ ] Bugfix (corrección de error)
- [x] Refactor (mejora de código sin cambiar funcionalidad)
- [ ] Performance (optimización)
- [ ] Documentation (documentación)
- [x] Chore (tareas de mantenimiento)

## Prioridad
- [x] Alta (bloquea funcionalidad crítica)
- [ ] Media (importante pero no bloqueante)
- [ ] Baja (mejora o nice-to-have)

## Descripción

### Problema/Requerimiento
Tras la refactorización del frontend (JDG-067), correcciones de rutas de import, creación de InputManager en `driving/input`, FrustumCuller, y ajustes en jump-handler/combat-input/input-action-checker, es necesario realizar una **revisión a fondo** para confirmar que no quedaron regresiones ocultas. A simple vista todo parece funcionar, pero debe verificarse de forma sistemática: carga del mundo, input, física, combate, animaciones, terreno, armas, celeste, y ausencia de errores en consola o imports rotos.

### Comportamiento Actual
- El juego carga y se puede jugar; no se han reportado fallos evidentes tras los últimos cambios.
- No existe una checklist formal de revisión post-refactor ni un registro de qué flujos se validaron.

### Comportamiento Esperado
- Checklist de revisión ejecutada y documentada (en el ticket o en un archivo de instrucciones).
- Todos los flujos críticos verificados: sin errores en consola, sin 404 de módulos, sin regresiones en movimiento, salto, combate, animaciones, terreno, armas, celeste, debug.
- Cualquier incidencia encontrada documentada y, si aplica, derivada a bugs o tickets de seguimiento.

## Contexto Técnico

### Componentes Afectados
- [ ] Backend (FastAPI)
- [x] Frontend (Three.js)
- [ ] Base de Datos (PostgreSQL)
- [ ] Cache (Redis)
- [ ] Docker/Infraestructura
- [ ] API Endpoints
- [ ] WebSockets

### Tecnologías Involucradas
- JavaScript ES6+, módulos ES
- Three.js, ECS (world.js, sistemas de input, física, combate, animación, armas, terreno)
- Navegador (Chrome/Firefox recomendado para pruebas)
- Servidor estático o Docker para simular entorno de despliegue (rutas de import)

### Archivos/Componentes Principales
- `frontend/src/app.js` – Orquestación, creación de TerrainManager, ECS, InputManager, sistemas.
- `frontend/src/driving/game/game-bootstrap.js` – Creación de ports y App.
- `frontend/src/driving/input/input-manager.js` – Input (teclado, ratón); usado por InputSystem, JumpHandler, CombatInputProcessor, InputActionChecker.
- `frontend/src/rendering/ecs/domains/input/` – InputSystem, jump-handler, combat-input-processor, input-action-checker.
- `frontend/src/rendering/terrain/manager.js` – TerrainManager, partículas, UpdateSystem.
- `frontend/src/rendering/ecs/` – ECSManager, sistemas (physics, combat, animation, weapon, collision, render).
- `frontend/src/application/` – load-world, spawn-player.
- `frontend/src/adapters/http/` – APIs (partículas, bloques, personajes, celeste, agrupaciones).
- `frontend/src/config/`, `frontend/src/debug/` – Rutas de import usadas por terrain, animation, weapon, etc.
- Consola del navegador y pestaña Network (módulos, 404).

## Criterios de Aceptación

1. [ ] **Carga y bootstrap:** La demo carga sin errores en consola; no hay 404 en carga de módulos (JS); el mundo y la dimensión se cargan correctamente.
2. [ ] **Input:** Teclado y ratón funcionan; movimiento WASD, salto (simple/doble/triple/vuelo), esquivar (dodge), bloqueo (parry); no aparece `isKeyDown` ni `isMouseButtonDown` is not a function.
3. [ ] **Física y colisiones:** El personaje cae con gravedad, colisiona con el terreno, no atraviesa suelo; saltos y vuelo se comportan como antes.
4. [ ] **Combate y animaciones:** Ataques (normal, pesado, cargado, especial con modificadores), combos, animaciones de movimiento (caminar, agacharse, nadar) y de combate se ejecutan sin errores; transiciones de estado correctas.
5. [ ] **Armas:** Equipar/desequipar arma, visualización en mano, animaciones de ataque con arma; sin errores en weapon-equip-system ni en loaders (model-loader, model-cache, bones-utils).
6. [ ] **Terreno y partículas:** TerrainManager carga partículas del backend; viewport y actualización al moverse funcionan; no hay errores en particle-renderer, particle-limiter, frustum-culling; rutas a config/particle-optimization-config y debug/logger correctas.
7. [ ] **Celeste y ambiente:** Sol/luna, temperatura/ambiente si aplica; celestial-renderer sin errores; rutas a debug/logger correctas.
8. [ ] **Debug y herramientas:** Panel de debug, logger, métricas (si están expuestos) funcionan; sin errores por imports a debug/ o config/.
9. [ ] **Rutas de import:** Ningún módulo falla por rutas relativas incorrectas (especialmente desde carpetas profundas: animation, weapon, terrain, input); verificación en entorno servido (no solo file://) si es posible.
10. [ ] **Documentación del resultado:** Checklist completada y resultado (OK o lista de incidencias) registrado en el ticket o en un archivo de revisión en `instructions/` (ej. `revision-JDG-067.md`).

**Nota:** Cada criterio debe ser comprobado de forma explícita (paso a paso o anotando "verificado" por ítem).

## Detalles de Implementación

### Consideraciones Técnicas
- **Entorno de prueba:** Probar con el mismo tipo de servidor con el que se desplegará (ej. Docker/nginx o servidor de desarrollo) para reproducir rutas de módulos; evitar solo file:// si antes hubo problemas de rutas.
- **Navegador:** Probar al menos en un navegador moderno (Chrome o Firefox); consola abierta sin filtros para ver errores y warnings.
- **Cobertura:** No es necesario escribir tests automatizados en este ticket; la revisión es manual pero sistemática según la checklist.

### Dependencias
- Depende de: JDG-067 (y correcciones posteriores de InputManager, rutas, etc.).
- No bloquea otros tickets; es una verificación de calidad post-refactor.

## Testing

### Escenarios de Prueba
1. **Escenario carga:** Abrir la app → loadDemo() → comprobar que no hay errores en consola y que el terreno/personaje aparecen.
2. **Escenario movimiento y salto:** WASD, salto simple, doble salto, triple salto (vuelo); comprobar que no hay errores y que el comportamiento es el esperado.
3. **Escenario combate:** Ataque normal, pesado, con Shift/Ctrl/Alt; parry, dodge; combos; comprobar animaciones y que no aparecen errores de input.
4. **Escenario armas:** Equipar arma, atacar con arma, desequipar; comprobar que no hay 404 de model-loader/model-cache/bones-utils ni errores en weapon-equip-system.
5. **Escenario terreno:** Moverse por el mundo; comprobar que el terreno se actualiza (partículas), que no hay errores en TerrainManager ni en particle-renderer, y que las rutas a config y debug son correctas.
6. **Escenario celeste:** Verificar que el sol/luna y el renderer celeste funcionan y que no hay errores en celestial-renderer (rutas a debug).
7. **Escenario debug:** Abrir panel de debug / herramientas de desarrollo si aplica; comprobar que no hay errores por imports a debug/ o config/.

### Casos Edge a Considerar
- Jugador en borde del viewport o en transición de chunk de partículas.
- Cambio rápido de animación (movimiento ↔ combate ↔ salto).
- Múltiples inputs en el mismo frame (teclas + ratón).
- Primera carga con caché vacía vs. recarga con caché.

## Estimación

- **Complejidad:** Baja (ejecución de checklist; no desarrollo de features).
- **Tiempo estimado:** 2–4 horas (revisión manual exhaustiva y documentación del resultado).
- **Notas:** Si se encuentran bugs, el tiempo puede extenderse para documentarlos o abrir tickets de bugfix.

## Referencias

- **Relacionado con:** JDG-067 (Refactorización frontend Hexagonal + ECS), JDG-068 (Completar Hexagonal al 100%).
- **Documentación relevante:** `docs/frontend-estructura-elegida.md`, READMEs de `frontend/src/rendering/`, `frontend/src/driving/`, `frontend/src/application/`.
- **Discusiones previas:** Revisión a fondo para confirmar que no se rompió nada tras la refactorización.

## Notas Adicionales

- Este ticket es de **verificación y calidad**; el entregable es la ejecución de la checklist y el registro del resultado (todo OK o lista de incidencias).
- Si se encuentran incidencias, se pueden anotar en la sección "Resultado de la revisión" al cerrar el ticket o en un archivo `instructions/revision-JDG-067.md` (o similar) para trazabilidad.
- Recomendable ejecutar esta revisión antes de dar por cerrado JDG-067 en producción o antes de iniciar JDG-068 si se quiere una base estable.
